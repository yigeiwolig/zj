<!-- pages/my/my.wxml -->

<view class="container">

  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="header">
    <view class="back-icon" catchtap="goBack">
      <text style="font-size: 48rpx; font-weight: 300; color: #000; line-height: 1;">â€¹</text>
    </view>
  </view>

  <!-- 2. ç”¨æˆ·ä¸ªäººä¿¡æ¯ - ã€ç®¡ç†å‘˜æ¨¡å¼ä¸‹éšè—ã€‘ -->
  <view class="profile-header" wx:if="{{!isAdmin}}">
    <view class="header-content">
      <view class="user-identity">
        <text class="rank-tag">PLATINUM MEMBER</text>
        <text class="user-name">{{userName}}</text>
      </view>
      <view class="header-stats">
        <view class="stat-item">
          <text class="label">æ‹¥æœ‰äº§å“æ•°é‡</text>
          <text class="value">{{deviceList.length}} ä»¶</text>
        </view>
        <view class="divider-v"></view>
        <view class="stat-item">
          <text class="label">ä¼šå‘˜ç­‰çº§</text>
          <text class="value platinum">é“‚é‡‘å°Šäº«ä¼šå‘˜</text>
        </view>
      </view>
    </view>
  </view>

  <!-- === ã€æ ¸å¿ƒä¿®æ”¹åŒºåŸŸï¼šç®¡ç†å‘˜ç•Œé¢ã€‘ === -->
  <block wx:if="{{isAdmin}}">
    
    <!-- 1. æ ‡é¢˜æ  + åˆ‡æ¢æŒ‰é’® -->
    <view class="admin-header-row">
      <view class="admin-page-title">
        å¾…å¤„ç†è®¢å•
      </view>
      
      <view class="admin-header-right">
        <!-- éœ€å¯„å›è®¢å•ç¡®è®¤æŒ‰é’® -->
        <view class="return-required-btn" bindtap="openReturnRequiredModal">
          éœ€å¯„å›è®¢å•ç¡®è®¤
        </view>
      </view>
    </view>

    <!-- 2. å¾…ç‰©æ–™å‘å‡º (æ¨ªå‘ Swiper) -->
    <swiper 
      class="order-swiper" 
      bindchange="onOrderChange" 
      circular 
      previous-margin="60rpx" 
      next-margin="60rpx"
      style="height: {{swiperHeight}}px; transition: height 0.3s ease;"
    >
      <!-- å¦‚æœæ²¡æœ‰å¾…ç‰©æ–™å‘å‡ºè®¢å• -->
      <swiper-item wx:if="{{pendingList.length === 0}}">
        <view class="empty-card">ğŸ‰ å¤ªæ£’äº†ï¼Œæ‰€æœ‰è®¢å•éƒ½å·²ç‰©æ–™å‘å‡ºï¼</view>
      </swiper-item>

      <!-- å¾ªç¯ pendingList -->
      <swiper-item wx:for="{{pendingList}}" wx:key="id" wx:for-index="idx">
        <view class="order-card detail-mode" id="card-{{idx}}">
          
          <!-- 1. å¤´éƒ¨ï¼šä¿®å¤ä½ç½®ä¸å¯¹çš„é—®é¢˜ -->
          <view class="card-header">
            <view class="order-id-group">
              <text class="order-label">è®¢å•å·</text>
              <text class="order-val">{{item.orderId}}</text>
            </view>
            <view class="status-tag {{item.realStatus}}">{{item.statusText}}</view>
          </view>

          <!-- ã€å…³é”®ã€‘ä¹°å®¶ä¿¡æ¯æ ï¼šæ˜¾ç¤ºæ˜µç§°ã€ç”µè¯ã€åœ°å€ -->
          <view class="buyer-info-box">
            <view class="b-row">
              <text class="b-name">{{item.userName || 'åŒ¿åç”¨æˆ·'}}</text>
              <text class="b-phone">{{item.userPhone}}</text>
            </view>
            <view class="b-addr">{{item.userAddr}}</view>
          </view>

          <!-- 2. ä¸­é—´å•†å“åˆ—è¡¨ -->
          <view class="goods-detail-list">
            <view class="mini-tag">è´­ç‰©æ¸…å•</view>
            <block wx:for="{{item.goodsList}}" wx:for-item="g" wx:key="index">
              <view class="g-item">
                <view class="g-info">
                  <text class="g-n">{{g.name}}</text>
                  <text class="g-s">{{g.spec}}</text>
                </view>
                <view class="g-count">x{{g.quantity}}</view>
                <view class="g-p">Â¥{{g.total}}</view>
              </view>
            </block>
          </view>

          <!-- 3. åº•éƒ¨ï¼šåˆè®¡ + æ“ä½œæŒ‰é’® -->
          <view class="card-footer-new">
            <view class="total-row">
              <text class="time-text">{{item.createTime}}</text>
              <view class="price-box">
                <text>å®ä»˜</text> 
                <!-- ã€ä¿®æ”¹ã€‘ç»™é‡‘é¢åŠ ä¸Šç‚¹å‡»äº‹ä»¶ï¼ˆç®¡ç†å‘˜å¾…ç‰©æ–™å‘å‡ºä¹Ÿå¯ä»¥æ”¹ä»·ï¼‰ -->
                <text 
                  class="price-num {{isAdmin && item.realStatus === 'PAID' ? 'editable-price' : ''}}" 
                  catchtap="adminModifyPrice" 
                  data-id="{{item.id}}" 
                  data-price="{{item.amount}}"
                  data-status="{{item.realStatus}}">
                  Â¥{{item.amount}}
                </text>
              </view>
            </view>
            <view 
              class="admin-ship-btn" 
              catchtap="adminShipOrder" 
              data-id="{{item.id}}" 
              data-orderid="{{item.orderId}}" 
              data-express="{{item.shippingMethod}}">
              å½•å…¥è¿å•å·å¹¶ç‰©æ–™å‘å‡º
            </view>
          </view>
        </view>
      </swiper-item>
    </swiper>

    <!-- [æ–°å¢] ç»´ä¿®å·¥å•å¤„ç†åŒº -->
    <view class="section-label" wx:if="{{repairList.length > 0}}">PENDING REPAIRS / å¾…å¤„ç†æŠ¥ä¿®</view>
    
    <view class="repair-list-admin">
      <block wx:for="{{repairList}}" wx:key="_id">
        <view class="repair-admin-card">
          <!-- è§†é¢‘é¢„è§ˆ -->
          <video src="{{item.videoFileID}}" class="repair-video" controls></video>
          
          <!-- ä¿¡æ¯ -->
          <view class="repair-info">
            <view class="r-title">{{item.model}} - {{item.contact.name}}</view>
            <view class="r-desc">"{{item.description}}"</view>
            <view class="r-addr">{{item.contact.address}}</view>
          </view>
          
          <!-- éœ€è¦å¯„å›å¼€å…³ -->
          <view class="repair-return-switch">
            <text class="switch-label">éœ€è¦å¯„å›</text>
            <switch 
              checked="{{item.needReturn}}" 
              bindchange="toggleReturnRequired" 
              data-id="{{item._id}}"
              color="#007AFF"
            />
          </view>
          
          <!-- çŠ¶æ€æ˜¾ç¤º -->
          <view class="repair-status-info" wx:if="{{item.returnStatus === 'USER_SENT' || item.status === 'USER_SENT'}}">
            <text class="repair-status-text">ç”¨æˆ·å·²å¯„å‡ºå¿«é€’</text>
            <text class="repair-tracking-id" wx:if="{{item.returnTrackingId}}">è¿å•å·ï¼š{{item.returnTrackingId}}</text>
          </view>
          
          <!-- æ“ä½œæŒ‰é’® -->
          <view class="repair-actions">
            <!-- å¦‚æœç”¨æˆ·å·²å¯„å‡ºï¼Œæ˜¾ç¤ºç»´ä¿®å®ŒæˆæŒ‰é’® -->
            <view class="r-btn complete" wx:if="{{item.returnStatus === 'USER_SENT' || item.status === 'USER_SENT'}}" bindtap="adminCompleteRepair" data-id="{{item._id}}">ç»´ä¿®å®Œæˆ</view>
            <!-- å¦‚æœç»´ä¿®å®Œæˆå·²å¯„å‡ºï¼Œæ˜¾ç¤ºçŠ¶æ€ -->
            <view class="repair-status-info" wx:if="{{item.status === 'REPAIR_COMPLETED_SENT'}}">
              <text class="repair-status-text">ç»´ä¿®å®Œæˆå·²å¯„å‡º</text>
              <text class="repair-tracking-id" wx:if="{{item.trackingId}}">è¿å•å·ï¼š{{item.trackingId}}</text>
            </view>
            <!-- å…¶ä»–çŠ¶æ€æ˜¾ç¤ºåŸæœ‰æŒ‰é’® -->
            <block wx:if="{{item.returnStatus !== 'USER_SENT' && item.status !== 'USER_SENT' && item.status !== 'REPAIR_COMPLETED_SENT'}}">
              <view class="r-btn return" bindtap="requestUserReturn" data-id="{{item._id}}">éœ€è¦ç”¨æˆ·å¯„å›</view>
              <view class="r-btn tutorial" bindtap="resolveRepair" data-id="{{item._id}}" data-type="tutorial">çœ‹æ•™ç¨‹å¯ä¿®</view>
              <view class="r-btn ship" bindtap="resolveRepair" data-id="{{item._id}}" data-type="ship">å½•å•å¤‡ä»¶å¯„å‡º</view>
            </block>
          </view>
        </view>
      </block>
    </view>


  </block>

  <!-- æ™®é€šç”¨æˆ·è§†å›¾ (ä¿æŒä¸å˜ï¼Œè¿˜æ˜¯ç”¨åŸæ¥çš„ swiper orders) -->
  <block wx:if="{{!isAdmin}}">
    <!-- æƒ…å†µ A: æœ‰è®¢å•ï¼Œæ˜¾ç¤ºæ»‘åŠ¨åˆ—è¡¨ -->
    <swiper 
      wx:if="{{orders.length > 0}}"
      class="order-swiper" 
      bindchange="onOrderChange" 
      circular 
      previous-margin="60rpx" 
      next-margin="60rpx"
      style="height: {{swiperHeight}}px; transition: height 0.3s ease;"
    >
      <swiper-item wx:for="{{orders}}" wx:key="id" wx:for-index="idx">
        <view class="order-card detail-mode" id="card-{{idx}}">
          
          <!-- 1. å¤´éƒ¨ -->
          <view class="card-header">
            <view class="order-id-group">
              <text class="order-label">è®¢å•å·</text>
              <text class="order-val">{{item.orderId}}</text>
            </view>
            <view class="status-tag {{item.realStatus}}">{{item.statusText}}</view>
          </view>

          <!-- ä¹°å®¶ä¿¡æ¯æ  -->
          <view class="buyer-info-box">
            <view class="b-row">
              <text class="b-name">{{item.userName || 'åŒ¿åç”¨æˆ·'}}</text>
              <text class="b-phone">{{item.userPhone}}</text>
            </view>
            <view class="b-addr">{{item.userAddr}}</view>
          </view>

          <!-- å•†å“åˆ—è¡¨ -->
          <view class="goods-detail-list">
            <view class="mini-tag">è´­ç‰©æ¸…å•</view>
            <block wx:for="{{item.goodsList}}" wx:for-item="g" wx:key="index">
              <view class="g-item">
                <view class="g-info">
                  <text class="g-n">{{g.name}}</text>
                  <text class="g-s">{{g.spec}}</text>
                </view>
                <view class="g-count">x{{g.quantity}}</view>
                <view class="g-p">Â¥{{g.total}}</view>
              </view>
            </block>
          </view>

          <!-- åº•éƒ¨ -->
          <view class="card-footer-new">
            <view class="total-row">
              <text class="time-text">{{item.createTime}}</text>
              <view class="price-box">
                <text>å®ä»˜</text> 
                <!-- ã€ä¿®æ”¹ã€‘ç»™é‡‘é¢åŠ ä¸Šç‚¹å‡»äº‹ä»¶ -->
                <!-- å¢åŠ ä¸€ä¸ª editable-price ç±»åï¼Œå¦‚æœæ˜¯ç®¡ç†å‘˜ä¸”æœªæ”¯ä»˜ï¼Œæ˜¾ç¤ºè™šçº¿æç¤ºå¯ç‚¹ -->
                <text 
                  class="price-num {{isAdmin && item.realStatus === 'UNPAID' ? 'editable-price' : ''}}" 
                  catchtap="adminModifyPrice" 
                  data-id="{{item.id}}" 
                  data-price="{{item.amount}}"
                  data-status="{{item.realStatus}}">
                  Â¥{{item.amount}}
                </text>
              </view>
            </view>

            <!-- 1. å¾…ä»˜æ¬¾ï¼šæ˜¾ç¤ºæ“ä½œæŒ‰é’® -->
            <view wx:if="{{item.realStatus === 'UNPAID'}}" class="action-row-right">
              
              <!-- ã€æ–°å¢ã€‘å·¦ä¾§çš„å–æ¶ˆè®¢å•æŒ‰é’® -->
              <view class="btn-mini outline-red" catchtap="userCancelOrder" data-id="{{item.id}}">
                å–æ¶ˆè®¢å•
              </view>

              <!-- å³ä¾§çš„æ”¯ä»˜æŒ‰é’® -->
              <view class="btn-mini black" catchtap="repayOrder" data-item="{{item}}">
                ç«‹å³æ”¯ä»˜
              </view>
              
            </view>

            <!-- 3. è¿è¾“ä¸­ï¼šæŸ¥çœ‹å®‰è£…æ•™ç¨‹å¹¶ç¡®è®¤æ”¶è´§ -->
            <view wx:if="{{item.realStatus === 'SHIPPED'}}" class="action-row-right">
              <!-- ç‰©æ–™è¿½è¸ªæŒ‰é’® -->
            <view 
                class="btn-mini outline" 
              catchtap="viewLogisticsDetail" 
              data-sn="{{item.trackingId}}">
                ç‰©æ–™è¿½è¸ª
              </view>
              <!-- æŸ¥çœ‹å®‰è£…æ•™ç¨‹æŒ‰é’® -->
              <view 
                class="btn-mini black" 
                catchtap="viewTutorialAndSign" 
                data-id="{{item.id}}" 
                data-model="{{item.goodsList && item.goodsList[0] ? item.goodsList[0].name : ''}}">
                â–¶ æŸ¥çœ‹å®‰è£…æ•™ç¨‹
              </view>
            </view>

            <!-- 4. å·²å®Œæˆï¼šå›é¡¾æ•™ç¨‹ -->
            <view wx:if="{{item.realStatus === 'SIGNED'}}" class="action-row-right">
              <view 
                class="btn-mini outline" 
                catchtap="viewTutorialOnly">
                å›é¡¾æ•™ç¨‹
              </view>
            </view>

          </view>
        </view>
      </swiper-item>
    </swiper>

    <!-- æƒ…å†µ B: æ²¡è®¢å•ï¼Œæ˜¾ç¤ºè¯±å¯¼å¡ç‰‡ -->
    <view 
      wx:else 
      class="empty-order-card" 
      bindtap="goToShop"
    >
      <view class="empty-content">
        <view class="empty-icon">ğŸ“¦</view>
        <view class="empty-title">å¼€å¯æ‚¨çš„æ”¹è£…ä¹‹æ—…</view>
        <view class="empty-desc">ä¸‹å•åï¼Œæ­¤å¤„å°†å®æ—¶è¿½è¸ªæ‚¨çš„ç‰©æ–™è¿›åº¦</view>
        
        <view class="go-shop-btn">å»é€‰è´­é…ä»¶ â”</view>
      </view>
    </view>
  </block>

  <!-- === æ”¹åŠ¨1ï¼šç®¡ç†å‘˜å®¡æ ¸åŒº (Swiperç‰ˆ) === -->
  <block wx:if="{{isAdmin && auditList.length > 0}}">
    <view class="section-label">PENDING AUDITS / å¾…å®¡æ ¸ç”³è¯·</view>
    
    <swiper 
      class="audit-swiper" 
      circular 
      previous-margin="60rpx" 
      next-margin="60rpx"
    >
      <swiper-item wx:for="{{auditList}}" wx:key="_id">
        <view class="audit-card">
          <view class="audit-row">
            <text class="audit-model">{{item.productModel}}</text>
            <text class="audit-sn">SN: {{item.sn}}</text>
          </view>
          <view class="audit-row">
            <!-- è¿™é‡Œåªåšå±•ç¤ºï¼Œä¿®æ”¹åœ¨å¼¹çª—é‡Œ -->
            <text class="audit-date">ç”¨æˆ·å¡«: {{item.buyDate}}</text>
            <text class="audit-type">{{item.bindType == 'new' ? 'å…¨æ–°' : 'äºŒæ‰‹'}}</text>
          </view>
          
          <view class="audit-imgs">
            <image src="{{item.imgReceipt}}" mode="aspectFill" class="audit-thumb" bindtap="previewImage" data-url="{{item.imgReceipt}}"></image>
            <image wx:if="{{item.imgChat}}" src="{{item.imgChat}}" mode="aspectFill" class="audit-thumb" bindtap="previewImage" data-url="{{item.imgChat}}"></image>
          </view>

          <view class="audit-actions">
            <!-- æ‹’ç»ç›´æ¥è°ƒç”¨ -->
            <view class="audit-btn reject" catchtap="handleReject" data-id="{{item._id}}">æ‹’ç»</view>
            <!-- é€šè¿‡æ‰“å¼€å¼¹çª— -->
            <view class="audit-btn approve" catchtap="openAuditModal" data-item="{{item}}">å®¡æ ¸è®¾ç½®</view>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </block>

  <!-- 5. è®¾å¤‡åˆ—è¡¨ - ã€ç®¡ç†å‘˜æ¨¡å¼ä¸‹éšè—ã€‘ -->
  <block wx:if="{{!isAdmin}}">
    <view class="section-label">MY DEVICES / äº§å“è®¾å¤‡</view>
    <view class="device-card" wx:for="{{deviceList}}" wx:key="sn">
      <view class="remove-icon" bindtap="removeDevice" data-index="{{index}}">âœ•</view>
      <view class="device-name">{{item.name}}</view>
      <view class="spec-list">
        <view class="spec-row">
          <text class="label">S/N åºåˆ—å·</text>
          <text class="value mono">{{item.sn}}</text>
        </view>
        <view class="spec-row">
          <text class="label">æ€»å‰©ä½™è´¨ä¿</text>
          <view class="warranty-val">
            <!-- å‰©ä½™å¤©æ•° -->
            <text class="days-num {{item.days < 30 ? 'warning' : ''}}">{{item.days}} Days</text>
            
            <!-- ğŸ‘‡ğŸ‘‡ğŸ‘‡ [æ–°å¢] èµ é€è´¨ä¿æ ‡è®° ğŸ‘‡ğŸ‘‡ğŸ‘‡ -->
            <view class="reward-tag" wx:if="{{item.hasReward}}">
               <text>ğŸ å·²è·èµ 30å¤©</text>
            </view>
            <!-- ğŸ‘†ğŸ‘†ğŸ‘† åªæœ‰ hasReward ä¸º true æ—¶æ‰æ˜¾ç¤º ğŸ‘†ğŸ‘†ğŸ‘† -->
            
            <!-- åŸæœ‰çš„å»¶ä¿æ ‡è®° (å¦‚æœæœ‰) -->
            <text class="ext-tag" wx:if="{{item.hasExtra && !item.hasReward}}">å«å»¶ä¿</text>
          </view>
        </view>
        <view class="spec-row">
          <text class="label">è´¨ä¿åˆ°æœŸæ—¥æœŸ</text>
          <text class="value">{{item.expiryDate}}</text>
        </view>
        <view class="spec-row">
          <text class="label">æ¿€æ´»æ¬¡æ•°</text>
          <text class="value">{{item.activations}} æ¬¡</text>
        </view>
        <view class="spec-row">
          <text class="label">å›ºä»¶ç‰ˆæœ¬</text>
          <text class="value">{{item.firmware}}</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ·»åŠ è®¾å¤‡å¤§æŒ‰é’® -->
    <view class="device-card add-mode" bindtap="openBindModal">
      <view class="add-content">
        <text class="big-plus">+</text>
        <text class="add-tips">ç»‘å®šæ–°äº§å“</text>
      </view>
    </view>

    <!-- ğŸ‘‡ğŸ‘‡ğŸ‘‡ã€æ ¸å¿ƒè¡¥å…¨ã€‘åœ¨è¿™é‡Œæ’å…¥ç”³è¯·è®°å½•åˆ—è¡¨ ğŸ‘‡ğŸ‘‡ğŸ‘‡ -->
    <!-- ã€æ–°å¢ã€‘éœ€å¯„å›é…ä»¶ç»´ä¿®å¡ç‰‡ï¼ˆä»…å½“æœªå½•å…¥å•å·æ—¶æ˜¾ç¤ºï¼‰ -->
    <view class="return-required-card" wx:if="{{myReturnRequiredRepair && !isAdmin && !myReturnRequiredRepair.returnTrackingId}}">
      <view class="rr-card-header">
        <view class="rr-card-title">éœ€å¯„å›é…ä»¶ç»´ä¿®</view>
        <view class="rr-card-badge">å¾…å¤„ç†</view>
      </view>
      <!-- æ˜¾ç¤ºå¤‡æ³¨ -->
      <view class="rr-card-note" wx:if="{{myReturnRequiredRepair.returnNote}}">
        <text class="rr-card-note-label">å¤‡æ³¨ï¼š</text>
        <text class="rr-card-note-text">{{myReturnRequiredRepair.returnNote}}</text>
      </view>
      <view class="rr-card-info">
        <view class="rr-card-info-item">
          <text class="rr-card-info-label">äº§å“å‹å·</text>
          <text class="rr-card-model">{{myReturnRequiredRepair.model}}</text>
        </view>
        <view class="rr-card-info-item">
          <text class="rr-card-info-label">æŠ¥ä¿®æ—¶é—´</text>
          <text class="rr-card-time">{{myReturnRequiredRepair.createTime}}</text>
        </view>
      </view>
      
      <!-- å¦‚æœå·²å½•å…¥å•å·ï¼Œæ˜¾ç¤ºçŠ¶æ€ -->
      <view class="rr-card-status" wx:if="{{myReturnRequiredRepair.returnTrackingId}}">
        <view class="rr-card-status-text">å·²å¯„å‡ºï¼Œç»´ä¿®ä¸­ï¼Œè¯·ç­‰å€™</view>
        <view class="rr-card-tracking-id">è¿å•å·ï¼š{{myReturnRequiredRepair.returnTrackingId}}</view>
      </view>
      
      <!-- å¦‚æœæœªå½•å…¥å•å·ï¼Œæ˜¾ç¤ºæŒ‰é’® -->
      <block wx:if="{{!myReturnRequiredRepair.returnTrackingId}}">
        <!-- å½•å…¥å•å·æŒ‰é’® - ç‚¹å‡»åæ‰“å¼€åº•éƒ¨å¼¹çª— -->
        <view class="rr-card-btn" bindtap="openReturnAddressModal" data-id="{{myReturnRequiredRepair._id}}">
          å½•å…¥å•å·
        </view>
        <!-- ä¸€é”®å¤åˆ¶åœ°å€æŒ‰é’® -->
        <view class="rr-card-btn copy-address" bindtap="copyReturnAddress">
          ä¸€é”®å¤åˆ¶åœ°å€
        </view>
      </block>
      
      <!-- å¦‚æœå·²å¡«å†™åœ°å€ä¿¡æ¯ï¼Œæ˜¾ç¤ºåœ°å€ -->
      <view class="rr-card-address-info" wx:if="{{myReturnRequiredRepair.returnAddress}}">
        <view class="ra-info-title">ä¿®å¥½åå¯„å›åœ°å€ï¼š</view>
        <view class="ra-info-content">
          <text>{{myReturnRequiredRepair.returnAddress.name}} {{myReturnRequiredRepair.returnAddress.phone}}</text>
          <text>{{myReturnRequiredRepair.returnAddress.address}}</text>
        </view>
      </view>
    </view>

    <view class="section-label" wx:if="{{myActivityList.length > 0}}">MY ACTIVITIES / ç”³è¯·è¿›åº¦</view>
    
    <view class="activity-list" wx:if="{{myActivityList.length > 0}}">
      <block wx:for="{{myActivityList}}" wx:key="_id">
        <!-- ç‚¹å‡»é©³å›çš„å¡ç‰‡å¯ä»¥é‡æ–°ä¸Šä¼  -->
        <view class="act-card" bindtap="{{item.status == -1 ? 'reUpload' : ''}}" data-item="{{item}}">
          
          <!-- ğŸ”´ ä¸»è¦å†…å®¹åŒºåŸŸï¼šä¿æŒæ¨ªå‘å¸ƒå±€ -->
          <view class="act-main-row">
            <view class="act-left">
              <!-- æ ‡é¢˜ï¼šæ˜¾ç¤ºæ˜¯è§†é¢‘è¿˜æ˜¯è®¾å¤‡ -->
              <view class="act-title">
                <text class="act-tag {{item.type}}">{{item.type === 'video' ? 'è§†é¢‘' : (item.type === 'repair' ? 'æ•…éšœ' : 'è®¾å¤‡')}}</text>
                <text class="act-name">{{item.title}}</text>
              </view>
              <view class="act-time">{{item.createTime}}</view>
            </view>
            
            <!-- å³ä¾§çŠ¶æ€ -->
            <view class="act-right">
              <!-- å®¡æ ¸ä¸­ (0 æˆ– PENDING) -->
              <view class="status-pill processing" wx:if="{{(item.type !== 'repair') && (item.status === 0 || item.status === 'PENDING')}}">
                <view class="dot-p"></view>å®¡æ ¸ä¸­
              </view>
              
              <!-- å·²é€šè¿‡ (1 æˆ– APPROVED) -->
              <view class="status-pill success" wx:if="{{(item.type !== 'repair') && (item.status === 1 || item.status === 'APPROVED')}}">
                <view class="dot-s"></view>å·²é€šè¿‡
              </view>
              
              <!-- å·²é©³å› (-1 æˆ– REJECTED) -->
              <view class="status-pill fail" wx:if="{{item.status === -1 || item.status === 'REJECTED'}}">å·²é©³å›</view>
              
              <!-- [æ–°å¢] ç»´ä¿®å•ç‰¹æ®ŠçŠ¶æ€ -->
              
              <!-- å·²ç»´ä¿®å®Œæˆï¼ˆéœ€è¦ç”¨æˆ·å¯„å›çš„æµç¨‹ï¼Œç®¡ç†å‘˜å¯„å‡ºå¿«é€’åï¼Œç»¿è‰²ï¼‰ -->
              <view class="status-pill success" wx:if="{{item.type === 'repair' && item.status === 'REPAIR_COMPLETED_SENT' && item.needReturn}}">
                <view class="dot-s"></view>å·²ç»´ä¿®å®Œæˆ
              </view>
              
              <!-- å·²å¤‡ä»¶å¯„å‡ºï¼ˆä¸æ˜¾ç¤ºè¿å•å·ï¼Œè¿å•å·åœ¨æŸ¥çœ‹ç‰©æµæŒ‰é’®ä¸­ï¼‰ -->
              <view class="status-pill success" wx:if="{{item.type === 'repair' && (item.status === 1 || item.status === 'SHIPPED') && item.trackingId && item.status !== 'REPAIR_COMPLETED_SENT'}}">
                é…ä»¶å·²å¯„å‡º
              </view>
              
              <!-- çœ‹æ•™ç¨‹ (è“è‰²) -->
              <view class="status-pill info" wx:if="{{item.type === 'repair' && (item.status === 1 || item.status === 'TUTORIAL') && !item.trackingId && item.status !== 'REPAIR_COMPLETED_SENT'}}">
                æŸ¥çœ‹æ•™ç¨‹å¯ä¿®å¤
              </view>
              
              <!-- ç»´ä¿®å•å®¡æ ¸ä¸­ -->
              <view class="status-pill processing" wx:if="{{item.type === 'repair' && (item.status === 0 || item.status === 'PENDING') && item.status !== 'USER_SENT' && item.returnStatus !== 'USER_SENT' && item.status !== 'REPAIR_COMPLETED_SENT'}}">
                <view class="dot-p"></view>å·¥ç¨‹å¸ˆå®¡æ ¸ä¸­
              </view>
              
              <!-- æ­£åœ¨ç»´ä¿®ä¸­ï¼ˆç”¨æˆ·å·²å¯„å‡ºå¿«é€’åï¼‰ -->
              <view class="status-pill processing" wx:if="{{item.type === 'repair' && (item.status === 'USER_SENT' || item.returnStatus === 'USER_SENT') && item.status !== 'REPAIR_COMPLETED_SENT'}}">
                <view class="dot-p"></view>æ­£åœ¨ç»´ä¿®ä¸­
              </view>
            </view>
          </view>
          
          <!-- ğŸ”´ æŸ¥çœ‹ç‰©æµæŒ‰é’®ï¼ˆæ˜¾ç¤ºåœ¨å·²å¤‡ä»¶å¯„å‡ºæˆ–å·²ç»´ä¿®å®ŒæˆçŠ¶æ€ï¼‰ -->
          <view class="logistics-btn-wrapper" wx:if="{{item.type === 'repair' && ((item.status === 1 || item.status === 'SHIPPED' || item.status === 'REPAIR_COMPLETED_SENT') && item.trackingId)}}">
            <view class="btn-logistics-action" catchtap="viewLogisticsDetail" data-sn="{{item.trackingId}}">
              æŸ¥çœ‹ç‰©æµ
            </view>
          </view>
          
          <!-- ğŸ”´ æ‹’ç»ç†ç”±ç‹¬ç«‹æ˜¾ç¤ºåœ¨ä¸‹æ–¹ï¼Œå®Œå…¨ä¸å½±å“ä¸Šé¢çš„å¸ƒå±€ -->
          <view class="reject-reason-wrapper" wx:if="{{(item.status === -1 || item.status === 'REJECTED') && item.rejectReason}}">
            <view class="reject-reason">
              <text class="reason-label">æ‹’ç»ç†ç”±ï¼š</text>
              <text class="reason-text">{{item.rejectReason}}</text>
            </view>
          </view>

        </view>
      </block>
    </view>
    <!-- ğŸ‘†ğŸ‘†ğŸ‘†ã€æ ¸å¿ƒè¡¥å…¨ã€‘ç»“æŸ ğŸ‘†ğŸ‘†ğŸ‘† -->

    <!-- 4. åº•éƒ¨æœåŠ¡æŒ‰é’® -->
    <view class="footer-bar">
      <view class="f-btn">é¢„çº¦ç»´ä¿®æœåŠ¡</view>
      <view class="f-btn dark">è”ç³»åœ¨çº¿å®¢æœ</view>
    </view>
  </block>

  <!-- 5. ç»‘å®šæ¨¡æ€æ¡† -->
  <view class="modal {{showModal ? 'show' : ''}}">
    <view class="modal-content">
      
      <!-- 1. æ–‡æ¡ˆä¿®æ”¹ï¼šç»‘å®šè®¾å¤‡ -->
      <view class="modal-header">
        <text>ç»‘å®šè®¾å¤‡</text>
        <view class="close-modal" bindtap="closeBindModal">âœ•</view>
      </view>

      <scroll-view scroll-y="true" class="modal-scroll-area">
        
        <!-- === 2. è“ç‰™æ‰«ææŒ‰é’® (é›·è¾¾) === -->
        <!-- åªæœ‰æœªè¿æ¥æ—¶æ˜¾ç¤º -->
        <view class="bt-scan-container" wx:if="{{!bluetoothReady}}">
          <view class="radar-circle" bindtap="startConnect">
            <view class="radar-core">
              <!-- ğŸ‘‡ğŸ‘‡ğŸ‘‡ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ¢æˆå›¾ç‰‡ ğŸ‘‡ğŸ‘‡ğŸ‘‡ -->
              <image class="bt-icon-img" src="data:image/svg+xml;base64,PHN2ZyB0PSIxNzEwNDg4ODg4ODg4IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQ3NTciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHBhdGggZD0iTTIyMy41NTIgNzI0LjQ4TDQ2NS45MiA1MTIgMjIzLjU1MiAyOTkuNTJsNTguOTA4LTY3LjI4TDQ5OC41MiA0MjEuNjg4VjM1Ljg0aDg5LjY4bDIzMC40IDIyNC42NC0yNDIuNTI4IDIxMi40OCAyNDIuNTI4IDIxMi40OC0yMzAuNCAyMjQuNjRINDk4LjUyVjYwMi4zMTJsLTIxNi4wNjQgMTg5LjQ0LTU4LjkwOC02Ny4yN3pNNTgyLjM1MiA1MTJMNjg4IDE5NC43NTIgNTg4LjE2IDk3LjQ0VjUxMnpNNTg4LjE2IDkyNi41Nkw2ODggODI5LjI0OCA1ODIuMzUyIDUxMnY0MTQuNTZ6IiBmaWxsPSIjRkZGRkZGIiBwLWlkPSI0NzU4Ij48L3BhdGg+PC9zdmc+" mode="aspectFit"></image>
            </view>
            
            <!-- æ³¢çº¹åŠ¨ç”» (ä¿æŒç»“æ„ï¼Œæ ·å¼ä¸‹é¢é‡å†™) -->
            <view class="radar-ring r1 {{isScanning?'anim':''}}"></view>
            <view class="radar-ring r2 {{isScanning?'anim':''}}"></view>
            <view class="radar-ring r3 {{isScanning?'anim':''}}"></view>
          </view>
          <text class="radar-tip">{{connectStatusText}}</text>
        </view>

        <!-- === 3. è¿æ¥æˆåŠŸåçš„çŠ¶æ€æ¡ === -->
        <view class="bt-connected-bar" wx:if="{{bluetoothReady}}">
          <view class="bt-c-icon">âœ…</view>
          <view class="bt-c-info">
            <text class="bt-c-name">å·²è¿æ¥è®¾å¤‡</text>
            <text class="bt-c-sn">{{connectedDeviceName}}</text>
          </view>
          <view class="bt-disconnect-btn" bindtap="resetBluetoothState">æ–­å¼€</view>
        </view>

        <!-- === 4. Tab åˆ‡æ¢ (é€»è¾‘ä¿®æ”¹ï¼šè¿ä¸Šè“ç‰™åæ‰æ˜¾ç¤ºï¼) === -->
        <view class="type-tabs" wx:if="{{bluetoothReady && !isDeviceLocked}}">
          <view class="tab-item {{bindType == 'new' ? 'active' : ''}}" bindtap="changeBindType" data-type="new">å…¨æ–°è®¾å¤‡</view>
          <view class="tab-item {{bindType == 'used' ? 'active' : ''}}" bindtap="changeBindType" data-type="used">äºŒæ‰‹/æ—§è®¾å¤‡</view>
        </view>

        <!-- === 5. è¢«é”çŠ¶æ€ === -->
        <view class="locked-view" wx:if="{{bluetoothReady && isDeviceLocked}}">
          <view class="locked-icon">ğŸš«</view>
          <text class="locked-title">æ— æ³•ç»‘å®š</text>
          <text class="locked-desc">{{lockedReason}}</text>
        </view>

        <!-- === 6. æ­£å¸¸å¡«è¡¨åŒºåŸŸ (è¿ä¸Šä¸”æ²¡é”æ‰æ˜¾ç¤º) === -->
        <view class="bind-form-area" wx:if="{{bluetoothReady && !isDeviceLocked}}">
          
          <view class="form-item">
            <text class="form-label">é€‰æ‹©äº§å“å‹å·</text>
            <picker bindchange="onModelChange" range="{{modelOptions}}">
              <view class="picker-val">{{modelOptions[modelIndex] || 'è¯·é€‰æ‹©å‹å·'}}</view>
            </picker>
          </view>

          <view class="form-item">
            <text class="form-label">{{bindType == 'new' ? 'ä¸Šä¼ å‡­è¯ (è´­ä¹°æˆªå›¾)' : 'ä¸Šä¼ å‡­è¯ (è´­ä¹°æˆªå›¾ + èŠå¤©è®°å½•)'}}</text>
            <view class="upload-group">
              <view class="upload-box" bindtap="chooseProofImage" data-type="receipt">
                <image wx:if="{{imgReceipt}}" src="{{imgReceipt}}" mode="aspectFill" class="uploaded-img" />
                <block wx:else><text class="plus-icon">+</text><text>è´­ä¹°æˆªå›¾</text></block>
              </view>
              <view class="upload-box" wx:if="{{bindType == 'used'}}" bindtap="chooseProofImage" data-type="chat">
                <image wx:if="{{imgChat}}" src="{{imgChat}}" mode="aspectFill" class="uploaded-img" />
                <block wx:else><text class="plus-icon">+</text><text>èŠå¤©è®°å½•</text></block>
              </view>
            </view>
          </view>

          <view class="form-item">
            <text class="form-label">è´­ä¹°æ—¥æœŸ</text>
            <picker mode="date" bindchange="onDateChange">
              <view class="picker-val">{{buyDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
            </picker>
          </view>
        </view>
        
        <view style="height: 40rpx;"></view>
      </scroll-view>

      <!-- åº•éƒ¨æäº¤æŒ‰é’® -->
      <view class="modal-footer" wx:if="{{bluetoothReady && !isDeviceLocked}}">
        <button class="submit-btn" bindtap="submitAudit">æäº¤ä¸Šä¼ å®¡æ ¸</button>
      </view>

    </view>
  </view>

  <!-- === æ”¹åŠ¨2ï¼šç®¡ç†å‘˜å®¡æ ¸å¼¹çª— (æ”¾åœ¨æœ€åº•éƒ¨) === -->
  <view class="modal {{showAuditModal ? 'show' : ''}}" style="z-index: 2000;">
    <view class="modal-content">
      <view class="modal-header">
        <text>å®¡æ‰¹è®¾ç½®</text>
        <view class="close-modal" bindtap="closeAuditModal">âœ•</view>
      </view>

      <view class="modal-scroll-area">
        <view class="form-item">
          <text class="form-label">ä¿®æ”¹è´­ä¹°æ—¥æœŸ (å½±å“å›ºä»¶ç‰ˆæœ¬)</text>
          <picker mode="date" value="{{adminSetDate}}" bindchange="onAdminDateChange">
            <view class="picker-val">{{adminSetDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>

        <view class="form-item">
          <text class="form-label">è®¾ç½®æ€»è´¨ä¿æ—¶é—´</text>
          <picker range="{{warrantyOptions}}" value="{{adminSetDaysIndex}}" bindchange="onAdminDaysChange">
            <view class="picker-val">{{warrantyOptions[adminSetDaysIndex]}}</view>
          </picker>
        </view>
      </view>

      <view class="modal-footer">
        <button class="submit-btn" bindtap="confirmApprove">ç¡®è®¤é€šè¿‡å¹¶åŒæ­¥</button>
      </view>
    </view>
  </view>

  <!-- ================= å…¨å±€è‡ªå®šä¹‰å¼¹çª— (æ›¿ä»£åŸç”Ÿ) ================= -->
  <view class="custom-dialog-mask" wx:if="{{dialog.show}}">
    <view class="custom-dialog-box">
      <view class="cd-title">{{dialog.title}}</view>
      <view class="cd-content">{{dialog.content}}</view>
      
      <view class="cd-btn-row">
        <!-- å–æ¶ˆæŒ‰é’® (å¯é€‰) -->
        <view class="cd-btn cancel" wx:if="{{dialog.showCancel}}" bindtap="closeCustomDialog">{{dialog.cancelText || 'å–æ¶ˆ'}}</view>
        <!-- ç¡®è®¤æŒ‰é’® -->
        <view class="cd-btn confirm" bindtap="onDialogConfirm">{{dialog.confirmText || 'ç¡®å®š'}}</view>
      </view>
    </view>
  </view>

  <!-- ================= è‡ªåŠ¨æ¶ˆå¤±æç¤ºï¼ˆæ— æŒ‰é’®ï¼Œ2ç§’åè‡ªåŠ¨æ¶ˆå¤±ï¼‰ ================= -->
  <view class="auto-toast-mask" wx:if="{{autoToast.show}}">
    <view class="auto-toast-box">
      <view class="at-title">{{autoToast.title}}</view>
      <view class="at-content">{{autoToast.content}}</view>
    </view>
  </view>

  <!-- ================= å…¨å±€è‡ªå®šä¹‰ Loading (ç™½è‰²èƒŒæ™¯è¿›åº¦æ¡) ================= -->
  <view class="loading-mask" wx:if="{{showLoadingAnimation}}">
    <view class="loader">
      <text class="loader-label">{{loadingText}}</text>
      <view class="loading-bar"></view>
    </view>
  </view>

  <!-- ================= è¾“å…¥å¼¹çª— (æ›¿ä»£ editable modal) ================= -->
  <view class="custom-dialog-mask" wx:if="{{inputDialog.show}}">
    <view class="custom-dialog-box">
      <view class="cd-title">{{inputDialog.title}}</view>
      <input 
        class="cd-input" 
        type="text" 
        placeholder="{{inputDialog.placeholder}}"
        value="{{inputDialog.value}}"
        bindinput="onInputDialogInput"
        confirm-type="done"
        bindconfirm="onInputDialogConfirm"
      />
      <view class="cd-btn-row">
        <view class="cd-btn cancel" bindtap="closeInputDialog">å–æ¶ˆ</view>
        <view class="cd-btn confirm" bindtap="onInputDialogConfirm">ç¡®å®š</view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿä¸€çš„"å†…å®¹å·²å¤åˆ¶"å¼¹çª—ï¼ˆæ ·å¼å’Œé¦–é¡µä¸€è‡´ï¼‰ -->
  <view class="custom-modal-mask" wx:if="{{showCopySuccessModal}}">
    <view class="custom-modal-box copy-success-modal">
      <view class="modal-icon-new success-icon">âœ“</view>
      <view class="modal-title-new">å†…å®¹å·²å¤åˆ¶</view>
    </view>
  </view>

  <!-- ================= éœ€å¯„å›è®¢å•ç¡®è®¤å¼¹çª— ================= -->
  <view class="return-required-mask" wx:if="{{showReturnRequiredModal}}" bindtap="closeReturnRequiredModal">
    <view class="return-required-modal" catchtap="noop">
      <view class="rr-header">
        <text class="rr-title">éœ€å¯„å›è®¢å•ç¡®è®¤</text>
        <text class="rr-close" bindtap="closeReturnRequiredModal">âœ•</text>
      </view>
      
      <scroll-view scroll-y class="rr-content">
        <block wx:for="{{returnRequiredList}}" wx:key="_id">
          <view class="rr-item {{item.returnTrackingId && (item.status === 'USER_SENT' || item.returnStatus === 'USER_SENT') ? 'user-sent' : (item.returnTrackingId ? 'returned' : 'pending')}}">
            <view class="rr-item-header">
              <text class="rr-model">{{item.model}}</text>
              <text class="rr-status-badge {{item.returnTrackingId && (item.status === 'USER_SENT' || item.returnStatus === 'USER_SENT') ? 'user-sent' : (item.returnTrackingId ? 'returned' : 'pending')}}">
                {{item.returnTrackingId && (item.status === 'USER_SENT' || item.returnStatus === 'USER_SENT') ? 'ç”¨æˆ·å¯„å›ç»´ä¿®' : (item.returnTrackingId ? 'å·²å¯„å›' : 'å¾…å¯„å›')}}
              </text>
            </view>
            
            <view class="rr-item-info">
              <view class="rr-info-row">
                <text class="rr-info-label">ç”¨æˆ·ä¿¡æ¯ï¼š</text>
                <text class="rr-info-value">{{item.contact.name}} {{item.contact.phone}}</text>
              </view>
              <view class="rr-info-row">
                <text class="rr-info-label">ç”¨æˆ·åœ°å€ï¼š</text>
                <view class="rr-info-value-wrapper">
                  <text class="rr-info-value">{{item.contact.address}}</text>
                  <view class="rr-copy-user-address-btn" bindtap="copyUserAddress" data-index="{{index}}">
                    <text class="rr-copy-text">å¤åˆ¶</text>
                  </view>
                </view>
              </view>
              <!-- å¦‚æœå·²å¡«å†™ä¿®å¥½åå¯„å›åœ°å€ï¼Œæ˜¾ç¤ºè¯¥åœ°å€ -->
              <view class="rr-info-row" wx:if="{{item.returnAddress}}">
                <text class="rr-info-label">ä¿®å¥½åå¯„å›åœ°å€ï¼š</text>
                <text class="rr-info-value">{{item.returnAddress.name}} {{item.returnAddress.phone}} {{item.returnAddress.address}}</text>
              </view>
              <view class="rr-info-row">
                <text class="rr-info-label">æ•…éšœæè¿°ï¼š</text>
                <text class="rr-info-value">{{item.description}}</text>
              </view>
              <view class="rr-info-row">
                <text class="rr-info-label">é…ä»¶å‘å‡ºæ—¶é—´ï¼š</text>
                <text class="rr-info-value">{{item.shipTime}}</text>
              </view>
              
              <!-- ç”¨æˆ·å½•å…¥çš„è¿å•å· -->
              <view class="rr-info-row" wx:if="{{item.returnTrackingId}}">
                <text class="rr-info-label">å¯„å›è¿å•å·ï¼š</text>
                <text class="rr-info-value">{{item.returnTrackingId}}</text>
              </view>
            </view>
            
            <!-- æ“ä½œæŒ‰é’® -->
            <view class="rr-actions">
              <!-- ç”¨æˆ·å¯„å›ç»´ä¿®ä¸­ï¼šæ˜¾ç¤ºæŸ¥çœ‹ç‰©æµå’Œå¯„å‡ºå¿«é€’ -->
              <block wx:if="{{item.returnTrackingId && (item.status === 'USER_SENT' || item.returnStatus === 'USER_SENT')}}">
                <view class="rr-btn logistics" bindtap="viewLogisticsDetail" data-sn="{{item.returnTrackingId}}">æŸ¥çœ‹ç‰©æµ</view>
                <view class="rr-btn ship-out" bindtap="adminShipOutAfterRepair" data-id="{{item._id}}">å¯„å‡ºå¿«é€’</view>
              </block>
              <!-- å…¶ä»–çŠ¶æ€ï¼šæ˜¾ç¤ºå–æ¶ˆå’Œå·²å®Œæˆ -->
              <block wx:else>
                <view class="rr-btn cancel" bindtap="cancelReturnRequired" data-id="{{item._id}}">å–æ¶ˆ</view>
                <view class="rr-btn logistics" wx:if="{{item.returnTrackingId}}" bindtap="viewLogisticsDetail" data-sn="{{item.returnTrackingId}}">æŸ¥çœ‹ç‰©æµ</view>
                <view class="rr-btn complete" bindtap="completeReturnRequired" data-id="{{item._id}}">å·²å®Œæˆ</view>
              </block>
            </view>
          </view>
        </block>
        
        <view class="rr-empty" wx:if="{{returnRequiredList.length === 0}}">
          <text>æš‚æ— éœ€å¯„å›çš„è®¢å•</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- ================= åœ°å€ä¿¡æ¯å¡«å†™å¼¹çª—ï¼ˆç®¡ç†å‘˜å¡«å†™ç”¨æˆ·åœ°å€ï¼‰ ================= -->
  <view class="custom-dialog-mask" wx:if="{{showReturnAddressDialog}}" bindtap="closeReturnAddressDialog">
    <view class="custom-dialog-box" catchtap="noop" style="max-width: 680rpx; padding: 50rpx 40rpx;">
      <view class="cd-title">å¡«å†™ç”¨æˆ·åœ°å€ä¿¡æ¯</view>
      <view class="cd-content" style="font-size: 26rpx; color: #999; margin-bottom: 30rpx; text-align: left;">
        ä¿®å¥½åå°†æŒ‰æ­¤åœ°å€å¯„å›ç»™ç”¨æˆ·
      </view>
      
      <view class="return-address-form">
        <view class="ra-form-item">
          <text class="ra-label">æ”¶ä»¶äººå§“å</text>
          <input 
            class="ra-input" 
            type="text" 
            placeholder="è¯·è¾“å…¥æ”¶ä»¶äººå§“å"
            value="{{tempReturnAddress.name}}"
            data-key="name"
            bindinput="onReturnAddressInput"
          />
        </view>
        
        <view class="ra-form-item">
          <text class="ra-label">æ”¶ä»¶äººæ‰‹æœºå·</text>
          <input 
            class="ra-input" 
            type="number" 
            placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·"
            value="{{tempReturnAddress.phone}}"
            data-key="phone"
            bindinput="onReturnAddressInput"
            maxlength="11"
          />
        </view>
        
        <view class="ra-form-item">
          <text class="ra-label">è¯¦ç»†åœ°å€</text>
          <textarea 
            class="ra-textarea" 
            placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€ï¼ŒåŒ…å«çœå¸‚åŒºä¿¡æ¯ï¼Œå¦‚ï¼šå¹¿ä¸œçœ ä½›å±±å¸‚ å—æµ·åŒº æŸæŸè¡—é“101å·"
            value="{{tempReturnAddress.address}}"
            data-key="address"
            bindinput="onReturnAddressInput"
            auto-height
            maxlength="200"
          />
        </view>
      </view>
      
      <view class="cd-btn-row">
        <view class="cd-btn cancel" bindtap="closeReturnAddressDialog">å–æ¶ˆ</view>
        <view class="cd-btn confirm" bindtap="confirmReturnAddress">ç¡®å®š</view>
      </view>
    </view>
  </view>

  <!-- ================= åº•éƒ¨åŠå±å¼¹çª—ï¼šå½•å…¥å•å·å’Œå¡«å†™åœ°å€ ================= -->
  <view class="bottom-modal-mask {{showReturnAddressModal ? 'show' : ''}}" bindtap="closeReturnAddressModal">
    <view class="bottom-modal-content" catchtap="noop">
      <!-- å¼¹çª—å¤´éƒ¨ -->
      <view class="bottom-modal-header">
        <view class="bottom-modal-title">å¡«å†™ä¿®å¥½åå¯„å›åœ°å€</view>
        <view class="bottom-modal-close" bindtap="closeReturnAddressModal">âœ•</view>
      </view>
      
      <!-- å¼¹çª—å†…å®¹åŒº -->
      <scroll-view class="bottom-modal-body" scroll-y>
        <view class="bottom-modal-form">
          <!-- å¦‚æœæœªå¡«å†™åœ°å€ï¼Œæ˜¾ç¤ºåœ°å€å¡«å†™è¡¨å• -->
          <view wx:if="{{!myReturnRequiredRepair.returnAddress}}">
            <view class="ra-form-smart-paste-wrapper">
              <view class="ra-form-smart-paste" bindtap="smartPasteAddress">
                <text class="ra-smart-paste-icon">ğŸ“‹</text>
                <text class="ra-smart-paste-text">æ™ºèƒ½ç²˜è´´</text>
              </view>
            </view>
            
            <view class="ra-form-item">
              <text class="ra-label">æ”¶ä»¶äººå§“å</text>
              <input 
                class="ra-input" 
                type="text" 
                placeholder="è¯·è¾“å…¥æ”¶ä»¶äººå§“å"
                value="{{userReturnAddress.name}}"
                data-key="name"
                bindinput="onUserReturnAddressInput"
              />
            </view>
            
            <view class="ra-form-item">
              <text class="ra-label">æ”¶ä»¶äººæ‰‹æœºå·</text>
              <input 
                class="ra-input" 
                type="number" 
                placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·"
                value="{{userReturnAddress.phone}}"
                data-key="phone"
                bindinput="onUserReturnAddressInput"
                maxlength="11"
              />
            </view>
            
            <view class="ra-form-item">
              <text class="ra-label">è¯¦ç»†åœ°å€</text>
              <textarea 
                class="ra-textarea" 
                placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€ï¼ŒåŒ…å«çœå¸‚åŒºä¿¡æ¯ï¼Œå¦‚ï¼šå¹¿ä¸œçœ ä½›å±±å¸‚ å—æµ·åŒº æŸæŸè¡—é“101å·"
                value="{{userReturnAddress.address}}"
                data-key="address"
                bindinput="onUserReturnAddressInput"
                auto-height
                maxlength="200"
              />
            </view>
          </view>
          
          <!-- å¦‚æœå·²å¡«å†™åœ°å€ï¼Œæ˜¾ç¤ºåœ°å€ä¿¡æ¯ -->
          <view wx:else>
            <view class="ra-info-section">
              <view class="ra-info-title">å·²å¡«å†™åœ°å€ä¿¡æ¯ï¼š</view>
              <view class="ra-info-content">
                <text>{{myReturnRequiredRepair.returnAddress.name}} {{myReturnRequiredRepair.returnAddress.phone}}</text>
                <text>{{myReturnRequiredRepair.returnAddress.address}}</text>
              </view>
            </view>
          </view>
          
          <!-- è¿å•å·è¾“å…¥ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼Œæ— è®ºæ˜¯å¦å¡«å†™åœ°å€ï¼‰ -->
          <view class="ra-form-item" style="margin-top: 40rpx;" wx:if="{{!myReturnRequiredRepair.returnTrackingId}}">
            <text class="ra-label">å½•å…¥å¯„å›è¿å•å·</text>
            <input 
              class="ra-input" 
              type="text" 
              placeholder="è¯·è¾“å…¥å¯„å›è¿å•å·"
              value="{{returnTrackingIdInput}}"
              bindinput="onReturnTrackingIdInput"
            />
          </view>
          
          <!-- å¦‚æœå·²å½•å…¥è¿å•å·ï¼Œæ˜¾ç¤ºè¿å•å·ä¿¡æ¯ -->
          <view class="ra-info-section" style="margin-top: 40rpx;" wx:if="{{myReturnRequiredRepair.returnTrackingId}}">
            <view class="ra-info-title">å·²å½•å…¥è¿å•å·ï¼š</view>
            <view class="ra-info-content">
              <text>{{myReturnRequiredRepair.returnTrackingId}}</text>
            </view>
          </view>
          
          <!-- ç»Ÿä¸€çš„æäº¤æŒ‰é’®ï¼ˆæäº¤åœ°å€å’Œè¿å•å·ï¼‰ -->
          <view class="ra-form-btn" bindtap="submitAddressAndTrackingId" wx:if="{{!myReturnRequiredRepair.returnTrackingId}}">
            æäº¤å•å·
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

</view>
