<view class="page admin-page">
  <!-- 顶部标题 -->
  <view class="page-header">
    <text class="page-title">产品上新</text>
    <!-- 只有白名单用户能看到的切换开关 -->
    <view 
      wx:if="{{isAuthorized}}" 
      class="admin-toggle-btn {{isAdmin ? 'on' : ''}}" 
      catchtap="toggleAdminMode">
      {{isAdmin ? 'EXIT' : 'EDIT'}}
    </view>
  </view>

  <!-- 产品列表（卡片形式） -->
  <scroll-view scroll-y class="product-scroll">
    <view class="product-list">
      <block wx:for="{{productList}}" wx:key="id" wx:for-item="item" wx:for-index="idx">
        <view class="product-card" bindtap="{{isAdmin ? '' : 'handleProductClick'}}" data-index="{{idx}}">
          <view class="product-cover-wrapper">
            <image class="product-cover" src="{{item.cover || ''}}" mode="aspectFill" />
            
            <!-- 号码显示（管理员模式，图片中间） -->
            <view wx:if="{{isAdmin}}" class="jump-number-badge" catchtap="adminEditJumpNumber" data-index="{{idx}}" hover-class="jump-number-badge-hover" style="z-index: 9999;">
              {{item.jumpNumber || '点击设置'}}
            </view>
          </view>
          
          <view class="product-info">
            <text class="product-title">{{item.name || '未命名产品'}}</text>
            <text class="product-price">¥{{item.models && item.models.length > 0 && item.models[0].price ? item.models[0].price : 0}} 起</text>
          </view>
        </view>
      </block>
      
      <view wx:if="{{!productList || productList.length === 0}}" class="empty-state">
        暂无产品，请在shop页面添加产品
      </view>
    </view>
  </scroll-view>

  <!-- 快速上新表单（保留） -->
  <view class="card">
    <view class="section-title">快速上新</view>
    <form bindsubmit="handleSubmit">
      <view class="form-group">
        <text class="label">标题</text>
        <input name="title" placeholder="输入产品标题" value="{{form.title}}" />
      </view>
      <view class="form-group">
        <text class="label">副标题</text>
        <input name="subtitle" placeholder="一句话描述" value="{{form.subtitle}}" />
      </view>
      <view class="form-group">
        <text class="label">封面链接</text>
        <input name="cover" placeholder="https://..." value="{{form.cover}}" />
      </view>
      <view class="form-group">
        <text class="label">标签（逗号分隔）</text>
        <input name="tags" placeholder="新品,SDK" value="{{form.tags}}" />
      </view>
      <view class="form-group">
        <text class="label">描述</text>
        <textarea name="description" placeholder="输入产品亮点" value="{{form.description}}" />
      </view>
      <view class="form-group">
        <text class="label">按钮文案</text>
        <input name="cta" placeholder="预约体验" value="{{form.cta}}" />
      </view>
      <button class="cta-btn primary-btn" formType="submit" loading="{{submitting}}">
        提交上新
      </button>
    </form>
  </view>

  <view class="card">
    <view class="section-title">最近一次提交</view>
    <view wx:if="{{lastSubmission}}">
      <text class="summary">标题：{{lastSubmission.title}}</text>
      <text class="summary">更新时间：{{lastSubmission.time}}</text>
    </view>
    <view wx:else class="empty-state">暂无提交记录</view>
  </view>


  <!-- 自定义编辑弹窗 -->
  <view class="custom-modal-mask" wx:if="{{showCustomEditModal}}">
    <view class="custom-modal-box">
      <view class="custom-modal-title">{{customEditTitle}}</view>
      <input class="custom-modal-input" value="{{customEditVal}}" bindinput="onCustomEditInput" focus="{{showCustomEditModal}}" cursor-spacing="100"/>
      <view class="custom-modal-btn-row">
        <view class="custom-btn c-btn-cancel" bindtap="closeCustomEditModal">取消</view>
        <view class="custom-btn c-btn-confirm" bindtap="confirmCustomEdit">确定</view>
      </view>
    </view>
  </view>
</view>


























