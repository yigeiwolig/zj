<view class="container">
  
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="navbar">
    <view class="nav-back" bindtap="goBack">â†</view>
    <view class="nav-logo">MT CONTROL</view>
  </view>

  <!-- ======================= -->
  <!-- æ–°å¢ï¼šè“ç‰™æœªå¼€å¯å¼¹çª— -->
  <!-- ======================= -->
  <view class="password-modal-mask" wx:if="{{showBluetoothAlert}}">
    <view class="password-box">
      <view class="bluetooth-icon-wrap">
        <image class="bt-icon-img" src="{{icons.btSmall}}" mode="aspectFit"></image>
      </view>
      <view class="pass-title">è“ç‰™æœªå¼€å¯</view>
      <view class="pass-desc">è¯·åœ¨æ‰‹æœºâ€œè®¾ç½®â€ä¸­æ‰“å¼€è“ç‰™åŠŸèƒ½\nä»¥ä¾¿è¿æ¥è®¾å¤‡</view>
      <view class="pass-btns">
        <view class="p-btn confirm full-width {{modalBtnDisabled ? 'btn-locked' : ''}}" bindtap="closeBluetoothAlert">çŸ¥é“äº†</view>
      </view>
    </view>
  </view>

  <!-- ======================= -->
  <!-- 1. å¯†ç éªŒè¯å¼¹çª— -->
  <!-- ======================= -->
  <view class="password-modal-mask" wx:if="{{showPasswordModal}}">
    <view class="password-box">
      <view class="pass-title">å®‰å…¨éªŒè¯</view>
      <view class="pass-desc">è°ƒèŠ‚æŠ˜å è§’åº¦éœ€è¦ç®¡ç†å‘˜æƒé™</view>
      <input class="pass-input" type="number" password="true" maxlength="4" placeholder="è¯·è¾“å…¥å¯†ç " bindinput="onPasswordInput" value="{{passwordInput}}"/>
      <view class="pass-btns">
        <view class="p-btn cancel" bindtap="cancelPassword">å–æ¶ˆ</view>
        <view class="p-btn confirm {{passwordBtnLocked ? 'btn-locked' : ''}}" bindtap="confirmPassword">{{passwordBtnText}}</view>
      </view>
    </view>
  </view>

  <!-- ======================= -->
  <!-- 2. æ“ä½œæŒ‡å¼•å¼¹çª— -->
  <!-- ======================= -->
  <view class="password-modal-mask" wx:if="{{showTutorialModal}}">
    <view class="password-box">
      <view class="pass-title" style="margin-bottom: 60rpx;">æ“ä½œæŒ‡å¼•</view>
      <view class="anim-stage">
        <view class="ring-btn-wrapper {{animIsPressing ? 'pressing' : ''}}">
           <view class="ring-outer {{animLightOn ? 'light-on' : ''}}">
             <view class="ring-inner"></view>
           </view>
           <view class="sim-finger-tap" wx:if="{{animIsPressing}}"></view>
        </view>
        <text class="anim-desc">{{animText}}</text>
      </view>
      <view class="pass-btns">
        <view class="p-btn confirm full-width {{tutorialBtnLocked ? 'btn-locked' : ''}}" bindtap="finishTutorial">{{tutorialBtnText}}</view>
      </view>
    </view>
  </view>

  <!-- ======================= -->
  <!-- 3. å…³é’¥åŒ™åŠ¨ç”»å¼¹çª— -->
  <!-- ======================= -->
  <view class="password-modal-mask" wx:if="{{showKeyModal}}">
    <view class="password-box">
      <view class="pass-title" style="margin-bottom: 60rpx;">æ“ä½œå®Œæˆ</view>
      <view class="anim-stage">
        <view class="key-circle {{keyAnimState === 'grey' ? 'key-grey' : ''}}">
          <view class="key-bar {{keyAnimState === 'grey' ? 'turn-left' : ''}}"></view>
        </view>
        <text class="anim-desc">å…³é—­è½¦é’¥åŒ™\né‡æ–°æ‰“å¼€</text>
      </view>
      <view class="pass-btns">
        <view class="p-btn confirm full-width {{keyBtnLocked ? 'btn-locked' : ''}}" bindtap="confirmKeyOff">{{keyBtnText}}</view>
      </view>
    </view>
  </view>

  <!-- ======================= -->
  <!-- åˆ—è¡¨åŒºåŸŸ -->
  <!-- ======================= -->
  <view class="gallery-container {{showDetail ? 'fade-out' : ''}}" 
        bindtouchstart="onTouchStartMain" 
        bindtouchmove="onTouchMoveMain"
        bindtouchend="onTouchEnd">
    <block wx:for="{{models}}" wx:key="id">
      <view class="card {{item.status}}" 
            data-index="{{index}}" 
            bindtap="onTapCard"
            style="transform: translateX({{item.status === 'active' ? (modelDragOffset + 'px') : (item.status === 'next' ? (nextCardOffsetPercent + '%') : (item.status === 'prev' ? (prevCardOffsetPercent + '%') : '0'))}}) scale({{item.status === 'active' ? modelActiveScale : modelSideScale}}); transition: {{isDraggingModel ? 'none' : 'all 0.35s cubic-bezier(0.25, 0.8, 0.25, 1)'}};">
        <view class="card-header">
          <view class="series-tag">{{item.tag}}</view>
          <view class="model-name">{{item.name}} <text class="model-suffix {{item.type === 'Max' ? 'max' : ''}} {{item.type === 'Pro Long' ? 'pro-long' : ''}} {{item.type === 'Max Long' ? 'max-long' : ''}}">{{item.type}}</text></view>
        </view>
        <view class="visual-area">
          <image class="custom-icon" src="{{item.icon}}" mode="aspectFit"></image>
        </view>
        <view class="action-btn" catchtap="openDetail" data-index="{{index}}">
          ç‚¹å‡»è¿›å…¥æ§åˆ¶å°
        </view>
      </view>
    </block>
    <view class="swipe-hint" style="pointer-events: none;">å·¦å³æ»‘åŠ¨åˆ‡æ¢</view>
  </view>

  <!-- ======================= -->
  <!-- è¯¦æƒ…ä¸æ§åˆ¶åŒº -->
  <!-- ======================= -->
  <view class="control-page {{showDetail ? 'show' : ''}}">
    
    <!-- å…¨å±å±…ä¸­å¸ƒå±€ -->
    <view class="device-stage centered-container">
      
      <!-- A. ä¸»è§†å›¾ -->
      <view class="view-layer {{detailMode === 'main' ? 'active' : ''}}">
        

        <view class="integrated-card">



          <!-- 1. é¡¶éƒ¨æ™ºèƒ½èƒ¶å›Š -->
          <!-- ä¿®æ”¹ç‚¹ï¼šç»™å¤–å±‚åŠ äº† connected-wrapper ç±»ï¼Œç”¨äºæ§åˆ¶å‘ä¸Šè´´åˆåŠ¨ç”» -->
          <view class="top-capsule-wrap {{isConnected ? 'connected-wrapper' : ''}}">
            <view class="smart-capsule {{isConnected ? 'connected' : ''}} {{isScanning || isConnecting ? 'scanning' : ''}}" 
                  bindtap="handleConnect">
              
              <!-- A. å¾…æœº -->
              <view class="capsule-content idle" wx:if="{{!isScanning && !isConnected && !isConnecting}}">
                <image class="idle-icon-img" src="{{icons.btSmall}}"></image>
                <text>ç‚¹å‡»è¿æ¥è®¾å¤‡</text>
              </view>

              <!-- B. æ‰«æ -->
              <view class="capsule-content scanning-ui" wx:if="{{isScanning}}">
                 <view class="scan-loader"><view class="wave"></view><view class="wave delay"></view></view>
                 <text>æœç´¢è®¾å¤‡ä¸­...</text>
              </view>

              <!-- C. ã€ä¿®æ”¹ã€‘æ­£åœ¨è¿æ¥ (ç™½è‰²å­— + ç™½è‰²åœˆ) -->
              <view class="capsule-content connecting-ui" wx:if="{{isConnecting}}">
                 <!-- ä½¿ç”¨é€šç”¨çš„ scan-loader å³å¯ï¼Œé»˜è®¤å°±æ˜¯ç™½è‰²çš„ -->
                 <view class="scan-loader"><view class="wave"></view><view class="wave delay"></view></view>
                 <text style="color:#FFFFFF">æ­£åœ¨è¿æ¥è®¾å¤‡...</text>
              </view>

              <!-- D. å·²è¿æ¥ -->
              <view class="capsule-content connected-ui" wx:if="{{isConnected}}">
                 <view class="status-left">
                   <view class="signal-group">
                     <view class="bar green"></view>
                     <view class="bar green"></view>
                     <view class="bar green"></view>
                   </view>
                   <text class="device-name">{{connectedDeviceName}}</text>
                 </view>
                 <view class="disconnect-btn" catchtap="handleDisconnect">
                   <view class="close-x"></view>
                 </view>
              </view>

            </view>
          </view>

          <!-- 2. ã€ä¿®æ”¹ã€‘æç¤ºå±‚ -->
          <!-- ç»Ÿä¸€æ”¾åœ¨è¿™é‡Œï¼Œä½ç½®å®Œå…¨å›ºå®š -->
          <view class="toast-container">
            <!-- é è¿‘è½¦è¾† -->
            <view class="toast {{showApproachTip ? 'show' : ''}}">
              <view class="t-icon warn">!</view>
              <text>è¯·é è¿‘è½¦è¾†ä»¥è¿æ¥</text>
            </view>
            <!-- è“ç‰™æ–­å¼€ -->
            <view class="toast {{showDisconnectTip ? 'show' : ''}}">
              <view class="t-icon err">!</view>
              <text>è“ç‰™å·²æ–­å¼€</text>
            </view>
            <!-- OTAæç¤º -->
            <view class="toast {{showOtaTip ? 'show' : ''}}">
              <view class="t-icon err">!</view>
              <text>è¯·å…ˆåœ¨OTAé¡µé¢è¿›è¡Œå‡çº§</text>
            </view>
          </view>
          
          <!-- 3. è®¾å¤‡å›¾ -->
          <view class="card-visual">
            <image class="card-device-img" src="{{currentModel.icon}}" mode="widthFix"></image>
          </view>

          <!-- 4. åº•éƒ¨æŒ‰é’® -->
          <view class="card-controls">
            <!-- æŒ‰é’®ä»£ç ä¿æŒä¸å˜ -->
            <view class="split-btn-group">
              <view class="split-item" bindtap="enterEdit" data-type="fold">
                <view class="btn-icon-circle"><image class="svg-icon" src="{{icons.lock}}"></image></view>
                <text class="btn-text">æŠ˜å è§’åº¦</text>
              </view>
              <view class="btn-divider"></view>
              <view class="split-item" bindtap="enterEdit" data-type="open">
                <view class="btn-icon-circle"><image class="svg-icon" src="{{icons.arrowUp}}"></image></view>
                <text class="btn-text">æ‰“å¼€è§’åº¦</text>
              </view>
            </view>

            <view class="split-btn-group" wx:if="{{currentModel.type === 'Max' || currentModel.type === 'Max Long'}}">
               <view class="split-item" style="{{currentModel.name === 'F1' ? 'opacity:0.3; pointer-events:none;' : ''}}" bindtap="handleAutoCalibrate">
                 <view class="btn-icon-circle"><image class="svg-icon" src="{{icons.cali}}"></image></view>
                 <text class="btn-text">è‡ªåŠ¨æ ¡å‡†</text>
               </view>
               <view class="btn-divider"></view>
               <view class="split-item" bindtap="openSettings">
                 <view class="btn-icon-circle"><image class="svg-icon" src="{{icons.gear}}"></image></view>
                 <text class="btn-text">é«˜çº§è®¾ç½®</text>
               </view>
            </view>
          </view>

        </view>
      </view>

      <!-- B. æŠ˜å ç¼–è¾‘ç•Œé¢ (å·²è¿˜åŸä¸ºæŒ‰é’®æ§åˆ¶æ¨¡å¼) -->
      <view class="view-layer {{detailMode === 'edit' && editType === 'fold' ? 'active' : ''}}">
        <view class="integrated-card">
           <!-- é¡¶éƒ¨ç©ºç™½ -->
           <view style="height: 100rpx;"></view>
           
           <!-- è§†è§‰åŒºåŸŸï¼šä¸¤æ ¹åˆ†å¼€çš„æ£å­ -->
           <view class="card-visual" style="flex-direction: column;">
              <view class="fold-visual-box">
                 <!-- å·¦è¾¹çš„æ£å­ -->
                 <view class="stick-simple"></view>
                 <!-- å³è¾¹çš„æ£å­ï¼ŒJS æ§åˆ¶ margin-left æ¥æ¨¡æ‹Ÿé—´è· -->
                 <view class="stick-simple" style="margin-left: {{foldGap}}rpx"></view>
              </view>
           </view>

           <!-- åº•éƒ¨æ§åˆ¶ -->
           <view class="card-controls">
              <!-- è¿˜åŸä¸ºæŒ‰é’®ç»„ -->
              <view class="split-btn-group" style="padding: 10rpx;">
                 <view class="split-item" bindtap="handleAdjust" data-action="left" data-mode="fold">
                    <text style="font-size:44rpx; font-weight:300;">â†</text>
                 </view>
                 
                 <view class="btn-divider"></view>
                 
                 <!-- ğŸ”´ ä¸­é—´ï¼šå¯æ»‘åŠ¨çš„è°ƒæ•´æŒ‰é’® -->
                 <view class="split-item adjust-slider-wrapper">
                    <!-- åº•å±‚ï¼šå½’é›¶æŒ‰é’®ï¼ˆæ»‘åŠ¨åæ˜¾ç¤ºï¼‰ -->
                    <view class="zero-btn-layer {{adjustSlideActive ? 'show' : ''}}" bindtap="handleAdjust" data-action="zero" data-mode="fold">
                      <text class="btn-text">å½’é›¶</text>
                    </view>
                    <!-- é¡¶å±‚ï¼šè°ƒæ•´æŒ‰é’®ï¼ˆå¯å‘ä¸Šæ»‘åŠ¨ï¼‰ -->
                    <view class="adjust-slider-btn {{adjustSlideActive ? 'active' : ''}}"
                          style="transform: translateY({{adjustSlideOffset}}px);"
                          bindtouchstart="onAdjustSlideStart"
                          bindtouchmove="onAdjustSlideMove"
                          bindtouchend="onAdjustSlideEnd"
                          bindtap="onAdjustClick">
                      <text class="btn-text">è°ƒæ•´</text>
                    </view>
                 </view>
                 
                 <view class="btn-divider"></view>
                 
                 <view class="split-item" bindtap="handleAdjust" data-action="right" data-mode="fold">
                    <text style="font-size:44rpx; font-weight:300;">â†’</text>
                 </view>
              </view>

              <!-- å®ŒæˆæŒ‰é’® (ç»å¯¹å±…ä¸­) -->
              <view class="footer-btn-area">
                 <view class="btn-finish-pill" bindtap="exitEdit">å®Œæˆè®¾ç½®</view>
              </view>
           </view>
        </view>
      </view>

      <!-- C. æ‰“å¼€ç¼–è¾‘ç•Œé¢ (ä¿®å¤æ£å­ + æ–°å¼¹çª—) -->
      <view class="view-layer {{detailMode === 'edit' && editType === 'open' ? 'active' : ''}}">
        
        <view class="integrated-card">
          <!-- 1. é¡¶éƒ¨æŒ‰é’® -->
          <view class="top-presets-row">
             <view class="preset-btn {{angleMode === '90' ? 'active' : ''}}" 
                   bindtap="switchAngle" data-angle="90">90Â°</view>
             
             <!-- F1/F2 é€»è¾‘ -->
             <block wx:if="{{filters.isF1Series(currentModel.name)}}">
                <view class="preset-btn {{angleMode === '180' ? 'active' : ''}}" 
                      bindtap="switchAngle" data-angle="180">180Â°</view>
             </block>
             <block wx:else>
                <view class="preset-btn {{angleMode === '160' ? 'active' : ''}}" 
                      bindtap="switchAngle" data-angle="160">160Â°</view>
             </block>
          </view>

          <!-- 2. ä¸­é—´ï¼šæ£å­ (ç‰©ç†ä¿®å¤ + è§’åº¦ä¿®æ­£) -->
          <view class="stick-visual-stage">
             <view class="stick-hinge-wrapper">
                <view class="stick-common stick-fixed"></view>
                <!-- æ—‹è½¬éƒ¨åˆ†ï¼š(180 - clamp(...)) ç¡®ä¿ 180åº¦æ˜¯ç«–ç›´å‘ä¸‹(Iå‹) -->
                <!-- ğŸ”´ ä¿®å¤ï¼šä½¿ç”¨ transition æ•°æ®è¦†ç›– CSS ä¸­çš„ transitionï¼Œé˜²æ­¢æ®‹ç•™åŠ¨ç”» -->
                <view class="stick-common stick-rotating" 
                      style="transform: rotate({{angleMode ? (180 - filters.clamp(currentAngle, 0, 180)) : 0}}deg); transition: {{transition || 'none'}};">
                </view>
             </view>
          </view>

          <!-- 3. æ•°å€¼ä¸æç¤º -->
          <view class="value-info-row">
             <!-- æ•°å€¼ï¼šæ¿€æ´»åæ˜¾ç¤ºï¼Œé™åˆ¶åœ¨ 0-180 -->
             <text class="val-big-text">{{angleMode ? filters.clamp(currentAngle, 0, 180) + 'Â°' : ''}}</text>
             
             <!-- çŠ¶æ€æ–‡æ¡ˆï¼š
                  1. classæ ¹æ® angleMode åˆ‡æ¢ waiting(çº¢) / success(ç»¿)
                  2. æ–‡æ¡ˆå†…å®¹æ ¹æ® F1/F2 è‡ªåŠ¨åˆ‡æ¢ (180 vs 160) 
             -->
             <text class="val-status-text {{angleMode ? 'success' : 'waiting'}}">
               {{angleMode ? statusText : ('ç‚¹å‡»' + (filters.isF1Series(currentModel.name) ? '180' : '160') + 'åº¦æˆ–90åº¦åŒæ­¥ç”»é¢')}}
             </text>
          </view>

          <!-- ========================================== -->
          <!-- ========================================== -->
          <!-- æ³¢è½®åŒºåŸŸï¼šæ¢å¤æ­£å¸¸è°ƒç”¨ -->
          <!-- ========================================== -->
          <view class="ruler-wave-area" bindtouchstart="onTouchStart" bindtouchmove="onTouchMove">
            <view class="mask-fade left"></view>
            <view class="mask-fade right"></view>
            
            <view class="wave-track" style="transform: translateX({{translateX}}px);">
               
               <!-- å·¦ä¾§è¡¥ç™½ -->
               <block wx:for="{{[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}}" wx:key="index">
                  <!-- ç§»é™¤ angleMode å‚æ•° -->
                  <view class="bar {{filters.getWaveClassByX(-50 + index, translateX)}}" 
                        style="{{index === 0 ? 'margin-left: -1000px;' : ''}}"></view>
               </block>

               <!-- ä¸­é—´æ­£æ–‡ -->
               <block wx:for="{{ticks}}" wx:key="index">
                  <view class="bar {{filters.getWaveClassByX(index, translateX)}}"></view>
               </block>

               <!-- å³ä¾§è¡¥ç™½ -->
               <block wx:for="{{[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}}" wx:key="index">
                  <view class="bar {{filters.getWaveClassByX((ticks.length || 91) + index, translateX)}}"></view>
               </block>

            </view>
          </view>

          <!-- 5. åº•éƒ¨æŒ‰é’® -->
          <view class="footer-btn-area">
             <view class="btn-finish-pill" bindtap="exitEdit">å®Œæˆè®¾ç½®</view>
          </view>
        </view>

        <!-- 6. æ•™å­¦å¼•å¯¼å¼¹çª— -->
        <view class="tutorial-mask" wx:if="{{showAngleHint && filters.isF1Series(currentModel.name)}}" catchtouchmove="true">
          <view class="guide-modal">
            <view class="guide-title" style="margin-bottom: 40rpx;">æ“ä½œæŒ‡å¼•</view>
            <view class="anim-stage">
               <view class="ring-btn-wrapper {{openAngleAnimIsPressing ? 'pressing' : ''}}">
                  <view class="ring-outer {{openAngleAnimLightOn ? 'light-on' : ''}}">
                     <view class="ring-inner"></view>
                  </view>
                  <view class="sim-finger-tap" wx:if="{{openAngleAnimIsPressing}}"></view>
               </view>
               <text class="anim-desc">{{openAngleAnimText}}</text>
            </view>
            <view class="guide-close-btn {{angleHintBtnLocked ? 'btn-locked' : ''}}" bindtap="dismissHint" style="margin-top: 60rpx;">{{angleHintBtnText}}</view>
          </view>
        </view>

      </view>

    </view> <!-- ç»“æŸ device-stage -->

    <!-- é«˜çº§è®¾ç½®å¼¹çª— -->
    <view class="modal-mask-new {{showSettingsModal ? 'show' : ''}}" bindtap="closeSettings">
      <view class="ui-toast {{toastClass}}">è¯·ç‚¹å‡»éœ€è¦æ›´æ”¹çš„è®¾ç½®</view>
      <view class="modal-body-new" catchtap="preventBubble">
        <view class="modal-header">
          <text class="m-title">é«˜çº§é…ç½®</text>
          <view class="m-close" bindtap="closeSettings">âœ•</view>
        </view>
        <view class="setting-row" wx:if="{{currentModel.name !== 'F1'}}">
          <view class="row-info"><text class="label-main">ä¸»åŠ¨æ•…éšœæ£€æµ‹</text><text class="label-sub">FAULT DETECTION</text></view>
          <view class="mag-track" data-key="faultDetect" data-state="{{settingState.faultDetect}}">
            <view class="click-pad left" catchtap="handleMagClick" data-key="faultDetect" data-val="left"></view>
            <view class="click-pad right" catchtap="handleMagClick" data-key="faultDetect" data-val="right"></view>
            <view class="track-labels"><text class="t-txt l">å¼€å¯</text><text class="t-txt r">å…³é—­</text></view>
            <view class="mag-thumb"></view>
          </view>
        </view>
        <view class="setting-row">
          <view class="row-info"><text class="label-main">æ•…éšœè‡ªä¿®å¤</text><text class="label-sub">SELF REPAIR</text></view>
          <view class="mag-track" data-key="selfRepair" data-state="{{settingState.selfRepair}}">
            <view class="click-pad left" catchtap="handleMagClick" data-key="selfRepair" data-val="left"></view>
            <view class="click-pad right" catchtap="handleMagClick" data-key="selfRepair" data-val="right"></view>
            <view class="track-labels"><text class="t-txt l">æ‰§è¡Œ</text><text class="t-txt r">å…³é—­</text></view>
            <view class="mag-thumb"></view>
          </view>
        </view>
        <view class="setting-row">
          <view class="row-info"><text class="label-main">å¼€æœºä½ç½®</text><text class="label-sub">POWER ON POS</text></view>
          <view class="mag-track" data-key="powerOn" data-state="{{settingState.powerOn}}">
            <view class="click-pad left" catchtap="handleMagClick" data-key="powerOn" data-val="left"></view>
            <view class="click-pad right" catchtap="handleMagClick" data-key="powerOn" data-val="right"></view>
            <view class="track-labels"><text class="t-txt l">ä¸Šç¿»</text><text class="t-txt r">ä¸‹ç¿»</text></view>
            <view class="mag-thumb"></view>
          </view>
        </view>
        <view class="setting-row">
          <view class="row-info"><text class="label-main">å…³æœºä½ç½®</text><text class="label-sub">SHUTDOWN POS</text></view>
          <view class="mag-track" data-key="shutdown" data-state="{{settingState.shutdown}}">
            <view class="click-pad left" catchtap="handleMagClick" data-key="shutdown" data-val="left"></view>
            <view class="click-pad right" catchtap="handleMagClick" data-key="shutdown" data-val="right"></view>
            <view class="track-labels"><text class="t-txt l">æ”¶å›</text><text class="t-txt r">ä¿æŒ</text></view>
            <view class="mag-thumb"></view>
          </view>
        </view>

      </view> 
    </view>   

  </view> <!-- ç»“æŸ control-page -->

  <!-- ======================= -->
  <!-- F1PRO/MAX ç¬¬äºŒæ­¥ï¼šå…¨æ–°äº§å“ 170åº¦ æ»‘åŠ¨æç¤º (æœ€ç»ˆç‰ˆ) -->
  <!-- ======================= -->
  <view class="tutorial-mask" wx:if="{{showNewProductHint}}" catchtouchmove="true">
    <view class="guide-modal">
      <view class="guide-title">å…¨æ–°äº§å“æç¤º</view>
      
      <view class="guide-desc" style="margin-bottom: 40rpx;">å¦‚æœæ˜¯å…¨æ–°äº§å“\nè¯·<text style="color:#007AFF; font-weight:bold;">å¾€å³æ»‘åŠ¨</text>æ³¢è½®\nå°†è§’åº¦è°ƒæ•´åˆ° 170Â° å·¦å³ä½¿ç”¨</view>

      <!-- åŠ¨ç”»åŒºåŸŸ -->
      <view class="gesture-anim-box">
        <!-- æ¨¡æ‹Ÿæ³¢è½®è½¨é“ (åŠ¨æ€å±‚) -->
        <view class="anim-track-mask">
           <view class="track-slider">
             <!-- è¿™é‡Œçš„åˆ»åº¦é“ºæ»¡ï¼Œç”¨äºæ»‘åŠ¨ -->
             <block wx:for="{{[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]}}" wx:key="*this">
               <view class="track-tick"></view>
             </block>
           </view>
        </view>

        <!-- æ¨¡æ‹Ÿæ‰‹æŒ‡ (è·Ÿéšç§»åŠ¨) -->
        <view class="anim-finger">
           <view class="finger-dot"></view>
           <view class="finger-shadow"></view>
        </view>
      </view>

      <!-- æŒ‰é’®ï¼šå¸¦å€’è®¡æ—¶ -->
      <view class="guide-close-btn {{newProductBtnLocked ? 'btn-locked' : ''}}" bindtap="closeNewProductHint">
        {{newProductBtnText}}
      </view>
    </view>
  </view>

</view> <!-- ç»“æŸ container -->

<!-- WXS æ ¸å¿ƒä¿®å¤ï¼šç§»é™¤ activeMode åˆ¤æ–­ï¼Œæ¢å¤è§†è§‰åŠ¨ç”» -->
<wxs module="filters">
var clamp = function(val, min, max) {
  var v = parseInt(val);
  if (isNaN(v)) return 0;
  if (v < min) return min;
  if (v > max) return max;
  return v;
}

// ä¿®æ”¹ï¼šä¸å†æ¥æ”¶ angleModeï¼Œå§‹ç»ˆè®¡ç®—æ³¢æµªæ ·å¼
var getWaveClassByX = function(index, translateX) {
  // 1. ç›´æ¥è®¡ç®—æ³¢æµªï¼Œä¸æ‹¦æˆª
  // è¿™æ ·æœªæ¿€æ´»æ—¶ï¼Œç”¨æˆ·æ»‘åŠ¨æ³¢è½®ï¼Œé»‘æ¡ä¾ç„¶ä¼šè·³åŠ¨ï¼ˆè§†è§‰åé¦ˆï¼‰
  var current = -translateX / 20;
  var centerIndex = Math.round(current);
  var diff = Math.abs(index - centerIndex);
  
  if (diff === 0) return 'active';
  if (diff === 1) return 'near-1';
  if (diff === 2) return 'near-2';
  if (diff === 3) return 'near-3';
  return '';
}

var isF1Series = function(name) {
  if (!name) return false;
  return name.indexOf('F1') > -1;
}

var getWaveClass = function(index, current) { return ''; }

module.exports = {
  getWaveClassByX: getWaveClassByX,
  clamp: clamp,
  isF1Series: isF1Series,
  getWaveClass: getWaveClass
};
</wxs>