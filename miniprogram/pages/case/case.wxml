<!-- èƒŒæ™¯å¤§æ°´å° -->
<view class="brand-bg-watermark">MT-æ‘©æ”¹ç¤¾</view>

<!-- é¡¶éƒ¨å¯¼èˆª -->
<view class="header" wx:if="{{!showVideoPlayer}}">
  <view class="back-icon" catchtap="goBack">
    <text style="font-size: 48rpx; font-weight: 300; color: #000; line-height: 1;">â€¹</text>
  </view>
</view>
<view class="custom-header" style="padding-top: {{statusBarHeight}}px;">
  <view class="header-content">
    <view class="header-title">
      <text>MT æ¡ˆä¾‹åº“</text>
      <!-- åªæœ‰ç™½åå•ç”¨æˆ·èƒ½çœ‹åˆ°çš„åˆ‡æ¢å¼€å…³ -->
      <view 
        wx:if="{{isAuthorized}}" 
        class="admin-toggle-btn {{isAdmin ? 'on' : ''}}" 
        catchtap="toggleAdminMode">
        {{isAdmin ? 'EXIT' : 'EDIT'}}
      </view>
      <!-- ç®¡ç†å‘˜æ¨¡å¼ä¸‹çš„å­æ¨¡å¼åˆ‡æ¢ -->
      <view 
        wx:if="{{isAdmin}}" 
        class="admin-submode-toggle">
        <view 
          class="submode-btn {{adminSubMode === 'edit' ? 'active' : ''}}" 
          catchtap="switchAdminSubMode" 
          data-mode="edit">
          è§†é¢‘ç¼–è¾‘
        </view>
        <view 
          class="submode-btn {{adminSubMode === 'manage' ? 'active' : ''}}" 
          catchtap="switchAdminSubMode" 
          data-mode="manage">
          ç®¡ç†ç°æœ‰è§†é¢‘
        </view>
      </view>
    </view>
  </view>
</view>

<!-- ğŸ†• å¯¼èˆªåŒºåŸŸå®¹å™¨ -->
<view class="nav-container" style="top: {{statusBarHeight + 44}}px;">
  
  <!-- 1. å¯æ»šåŠ¨çš„ Tab æ  -->
  <scroll-view 
    class="scroll-wrapper" 
    scroll-x="{{true}}" 
    show-scrollbar="{{false}}" 
    enhanced="{{false}}"
    scroll-left="{{scrollLeft}}" 
    scroll-with-animation="{{true}}"
  >
    <view class="tab-list">
      <!-- ğŸ†• é»‘è‰²æ»‘å— (ç»å¯¹å®šä½ï¼Œè´Ÿè´£åŠ¨ç”») -->
      <!-- sliderLeft å’Œ sliderWidth ç”± JS å®æ—¶è®¡ç®— -->
      <view class="tab-slider" style="left: {{sliderLeft}}px; width: {{sliderWidth}}px;"></view>

      <!-- æ–‡å­—æŒ‰é’® (èƒŒæ™¯é€æ˜ï¼Œåªè´Ÿè´£è§¦å‘äº‹ä»¶) -->
      <view class="tab-item {{currentTab === 'all' ? 'active' : ''}}" bindtap="switchTab" data-type="all">å…¨éƒ¨</view>
      <view class="tab-item {{currentTab === 'street' ? 'active' : ''}}" bindtap="switchTab" data-type="street">è¡—è½¦</view>
      <view class="tab-item {{currentTab === 'sport' ? 'active' : ''}}" bindtap="switchTab" data-type="sport">ä»¿èµ›</view>
      <view class="tab-item {{currentTab === 'scooter' ? 'active' : ''}}" bindtap="switchTab" data-type="scooter">è¸æ¿</view>
      <view class="tab-item {{currentTab === 'cruise' ? 'active' : ''}}" bindtap="switchTab" data-type="cruise">å·¡èˆª</view>
      <view class="tab-item {{currentTab === 'ebike' ? 'active' : ''}}" bindtap="switchTab" data-type="ebike">ç”µæ‘©</view>
      <view class="tab-item {{currentTab === 'bicycle' ? 'active' : ''}}" bindtap="switchTab" data-type="bicycle">ç”µåŠ¨è‡ªè¡Œè½¦</view>
    </view>
  </scroll-view>

  <!-- ğŸ†• åˆ˜æµ·æœç´¢æ  (é€šè¿‡ CSS è´Ÿè¾¹è·ä¸ä¸Šé¢è¿æ¥) -->
  <view class="search-notch {{showSearchBar ? 'open' : ''}}">
    <view class="search-inner">
      <input 
        class="search-input" 
        placeholder="ç‚¹è¿™é‡Œæœç´¢è½¦å‹" 
        placeholder-style="color:#666" 
        bindinput="onSearchInput" 
        value="{{searchText}}"
      />
      <view class="search-tip" wx:if="{{searchTip}}">{{searchTip}}</view>
    </view>
  </view>
</view>

<!-- ç®¡ç†å‘˜å¾…å®¡æ ¸åŒºåŸŸ (ç«–å‘å¤§å¡ç‰‡ç‰ˆ) -->
<view class="pending-section" wx:if="{{isAdmin && adminSubMode === 'edit' && pendingList.length > 0}}">
  <view class="section-header">
    <text>å¾…å¤„ç†ç´ æ ({{pendingList.length}})</text>
    <text style="font-size:22rpx; font-weight:400; color:#666; margin-left:20rpx;">éœ€ä¸‹è½½å¤„ç†åé‡æ–°ä¸Šä¼ </text>
  </view>
  
  <!-- æ”¹ä¸ºç«–å‘æ»šåŠ¨ scroll-y -->
  <scroll-view scroll-y class="pending-scroll" enhanced show-scrollbar="{{true}}">
    <view class="pending-list">
      <block wx:for="{{pendingList}}" wx:key="_id">
        <view class="pending-card full-width">
          
          <!-- 1. è§†é¢‘é¢„è§ˆåŒº (æå¤§) -->
          <video 
            class="pending-video-large" 
            src="{{item.videoFileID}}" 
            show-center-play-btn="{{true}}" 
            show-fullscreen-btn="{{true}}"
            controls="{{true}}"
            object-fit="contain"
          ></video>
          
          <!-- 2. ä¿¡æ¯åŒº -->
          <view class="pending-info">
            <view class="p-row">
              <!-- ğŸ‘‡ğŸ‘‡ğŸ‘‡ [ä¿®æ”¹] å¼ºåˆ¶åŠ ä¸Š MT å‰ç¼€ ğŸ‘‡ğŸ‘‡ğŸ‘‡ -->
              <view class="p-meta">
                <view class="p-badges">
                  <text class="badge badge-blue">{{item.model}}</text>
                  <text class="badge badge-black">MT{{item.sn}}</text>
                  <text class="badge badge-orange">ç¬¬{{item.applyCount || 1}}æ¬¡ç”³è¯·</text>
                </view>
                <view class="p-stats">
                  <text class="stat-pill stat-pass">é€šè¿‡ {{item.passCount || 0}}</text>
                  <text class="stat-pill stat-reject">æ‹’ç» {{item.rejectCount || 0}}</text>
                </view>
              </view>
              
              <text class="p-date">{{item.displayTime}}</text>
            </view>
            <text class="p-name-large">{{item.vehicleName}}</text>
          </view>
          
          <!-- 3. æ“ä½œæŒ‰é’®ç»„ -->
          <view class="pending-actions-large">
            <!-- æ‹’ç»ï¼šç»™ç”¨æˆ·å‘é©³å›é€šçŸ¥ -->
            <view class="act-btn-lg reject" bindtap="rejectPending" data-id="{{item._id}}">æ‹’ç»</view>
            
            <!-- æ ‡è®°ä¸ºå·²å¤„ç†/é€šè¿‡ (ä¸å‘å¸ƒï¼Œåªæ”¹çŠ¶æ€å‘Šè¯‰ç”¨æˆ·è¿‡äº†) -->
            <view class="act-btn-lg pass" bindtap="markAsProcessed" data-id="{{item._id}}">å·²é‡‡çº³</view>
            
            <!-- ä¸‹è½½ (å¿…é¡»ä¿ç•™ï¼Œä½ è¦æ‰“é©¬èµ›å…‹) -->
            <view class="act-btn-lg download" bindtap="downloadPending" data-fileid="{{item.videoFileID}}" data-id="{{item._id}}">â¬‡ ä¸‹è½½</view>
          </view>

        </view>
      </block>
      
      <!-- åº•éƒ¨å«é«˜ï¼Œé˜²æ­¢æœ€åä¸€ä¸ªè¢«é®æŒ¡ -->
      <view style="height: 40rpx;"></view>
    </view>
  </scroll-view>
</view>

<!-- ğŸ”´ æ ¸å¿ƒä¿®æ”¹ï¼šä½¿ç”¨ scroll-view åŒ…è£¹è§†é¢‘åˆ—è¡¨ -->
<!-- é«˜åº¦è®¡ç®—ï¼š100vh - (çŠ¶æ€æ  + æ ‡é¢˜æ 44px + å¯¼èˆªæ é«˜åº¦çº¦120rpx) -->
<scroll-view 
  class="main-scroll-view"
  scroll-y="{{true}}"
  bindscroll="handleScrollViewScroll" 
  enhanced="{{true}}"
  show-scrollbar="{{false}}"
  style="height: calc(100vh - {{statusBarHeight + 44 + 60}}px); top: {{statusBarHeight + 44 + 60}}px;"
>
  <!-- è§†é¢‘åˆ—è¡¨ (ğŸ”´ å¢åŠ  pushed-down ç±»ï¼Œå®ç°ä¸‹ç§»åŠ¨ç”») -->
  <view class="video-list {{showSearchBar ? 'pushed-down' : ''}}">
    <view wx:if="{{displayList.length === 0}}" style="width:100%; text-align:center; padding:100rpx 0; color:#999;">
      æš‚æ— æ¡ˆä¾‹è§†é¢‘
    </view>

    <block wx:for="{{displayList}}" wx:key="_id">
      <!-- ğŸ†• move-animation: å®ç°åˆ—è¡¨é‡æ’æ—¶çš„è¿‡æ¸¡æ•ˆæœ -->
      <view class="ios-card move-animation" bindtap="onCardTap" data-id="{{item._id}}">
        <view class="thumb-box" style="background-color: {{item.color}};">
          <image wx:if="{{item.coverUrl}}" src="{{item.coverUrl}}" mode="aspectFill" class="card-cover-img"></image>
          <view class="card-watermark-overlay">MT</view>
          
          <!-- ğŸ”´ ä¿®æ”¹ï¼šåˆ é™¤äº† class="play-icon-overlay" é‚£ä¸ªæ’­æ”¾æŒ‰é’® -->
          <!-- ç¼–è¾‘å›¾æ ‡ï¼ˆç®¡ç†å‘˜ç”¨ï¼Œä¸¤ç§æ¨¡å¼éƒ½æ˜¾ç¤ºï¼‰ -->
          <view 
            wx:if="{{isAdmin}}" 
            class="edit-icon-overlay" 
            catchtap="onEditIconTap" 
            data-id="{{item._id}}"
            data-stop-propagation="true">
            ğŸ”§
          </view>

          <!-- åˆ é™¤æŒ‰é’®ï¼ˆä»…åœ¨ç®¡ç†ç°æœ‰è§†é¢‘æ¨¡å¼ä¸‹æ˜¾ç¤ºï¼‰ -->
          <view wx:if="{{isAdmin && adminSubMode === 'manage'}}" class="delete-btn" catchtap="deleteCase" data-id="{{item._id}}">
            <view class="delete-x">Ã—</view>
          </view>
        </view>
        <view class="card-content">
          <!-- ğŸ”´ ä¿®æ”¹ï¼šè¿™é‡ŒåŠ äº† "è½¦å‹ï¼š" å‰ç¼€ -->
          <text class="card-title">è½¦å‹ï¼š{{item.title}}</text>
          <view class="card-meta">äº§å“å‹å·ï¼š{{item.model}}</view>
        </view>
      </view>
    </block>
    
    <!-- åº•éƒ¨å ä½ï¼Œé˜²æ­¢è¢«æ‚¬æµ®æŒ‰é’®æŒ¡ä½ -->
    <view style="height: 200rpx;"></view>
  </view>
</scroll-view>

<!-- åº•éƒ¨å‘å¸ƒæŒ‰é’® (é€šç”¨ï¼šå½•åˆ¶æˆ–ä¸Šä¼ ï¼Œç®¡ç†å‘˜ç¼–è¾‘æ¨¡å¼ä¸‹æ˜¾ç¤º) -->
<view class="fab-center" wx:if="{{!isAdmin || adminSubMode === 'edit'}}">
  <button class="publish-btn" bindtap="handleFabTap">
    <!-- çº¯ CSS ç»˜åˆ¶çš„åŠ å·å›¾æ ‡ -->
    <view class="icon-plus"></view>
  </button>
</view>

<!-- ================= å¼¹çª—åŒºåŸŸ ================= -->

<!-- 5. åˆå§‹ç¦åˆ©å¼¹çª— -->
<view class="modal-overlay active" wx:if="{{showIntro}}">
  <view class="ios-dialog">
    <view class="emoji-icon">ğŸ</view>
    <view class="dialog-title">ä¸Šä¼ è§†é¢‘èµ¢å»¶ä¿</view>
    <view class="dialog-desc">ä¸Šä¼ æ¡ˆä¾‹è§†é¢‘ï¼Œå®¡æ ¸é€šè¿‡åå³å¯è·å¾— <text class="highlight">1ä¸ªæœˆå»¶ä¿æœåŠ¡</text>ã€‚</view>
    <button class="dialog-btn" bindtap="closeIntro">æˆ‘çŸ¥é“äº†</button>
  </view>
</view>

<!-- 6. ç”¨æˆ·è¡¨å• -->
<view class="modal-overlay active" wx:if="{{showForm}}">
  <view class="ios-dialog left-align {{formShake ? 'shake' : ''}}">
    
    <!-- ğŸ†• æ–°å¢ï¼šå·¦ä¸Šè§’å…³é—­æŒ‰é’® -->
    <view class="dialog-close-x" bindtap="closeForm">Ã—</view>

    <view class="dialog-title center">å®Œå–„æ¡ˆä¾‹ä¿¡æ¯</view>
    <view class="form-group">
      <text class="form-label">è½¦å‹ä¿¡æ¯</text>
      <input class="ios-input" placeholder="ä¾‹å¦‚ï¼šé›…é©¬å“ˆ XMAX 300" bindinput="onInputVehicle" value="{{vehicleName}}" />
    </view>
    <view class="form-group">
      <text class="form-label">è½¦å‹åˆ†ç±»</text>
      <!-- çœŸæœºï¼šä½¿ç”¨åŸç”Ÿ picker -->
      <picker wx:if="{{!useCustomPicker}}" bindchange="bindCategoryChange" value="{{categoryIndex !== null ? categoryIndex : 0}}" range="{{categoryArray}}" style="width: 100%;">
        <view class="ios-select">{{categoryIndex!==null?categoryArray[categoryIndex]:'è¯·é€‰æ‹©'}}</view>
      </picker>
      <!-- æ¨¡æ‹Ÿå™¨ï¼šä½¿ç”¨è‡ªå®šä¹‰é€‰æ‹©å™¨ -->
      <view wx:else>
        <view class="ios-select" bindtap="showCategoryPicker">
          {{categoryIndex!==null?categoryArray[categoryIndex]:'è¯·é€‰æ‹©'}}
        </view>
        <view class="custom-picker-modal" wx:if="{{showCategoryPickerModal}}" catchtap="closeCategoryPicker">
          <view class="custom-picker-content" catchtap="preventBubble">
            <view class="picker-header">
              <text class="picker-cancel" bindtap="closeCategoryPicker">å–æ¶ˆ</text>
              <text class="picker-title">é€‰æ‹©è½¦å‹åˆ†ç±»</text>
              <text class="picker-confirm" bindtap="confirmCategoryPicker">ç¡®å®š</text>
            </view>
            <picker-view class="picker-view" value="{{categoryPickerValue}}" bindchange="onCategoryPickerChange">
              <picker-view-column>
                <view wx:for="{{categoryArray}}" wx:key="index" class="picker-item">{{item}}</view>
              </picker-view-column>
            </picker-view>
          </view>
        </view>
      </view>
    </view>
    <view class="form-group">
      <text class="form-label">äº§å“å‹å·</text>
      <!-- çœŸæœºï¼šä½¿ç”¨åŸç”Ÿ picker -->
      <picker wx:if="{{!useCustomPicker}}" bindchange="bindPickerChange" value="{{modelIndex !== null ? modelIndex : 0}}" range="{{modelArray}}" style="width: 100%;">
        <view class="ios-select">{{modelIndex!==null?modelArray[modelIndex]:'è¯·é€‰æ‹©'}}</view>
      </picker>
      <!-- æ¨¡æ‹Ÿå™¨ï¼šä½¿ç”¨è‡ªå®šä¹‰é€‰æ‹©å™¨ -->
      <view wx:else>
        <view class="ios-select" bindtap="showModelPicker">
          {{modelIndex!==null?modelArray[modelIndex]:'è¯·é€‰æ‹©'}}
        </view>
        <view class="custom-picker-modal" wx:if="{{showModelPickerModal}}" catchtap="closeModelPicker">
          <view class="custom-picker-content" catchtap="preventBubble">
            <view class="picker-header">
              <text class="picker-cancel" bindtap="closeModelPicker">å–æ¶ˆ</text>
              <text class="picker-title">é€‰æ‹©äº§å“å‹å·</text>
              <text class="picker-confirm" bindtap="confirmModelPicker">ç¡®å®š</text>
            </view>
            <picker-view class="picker-view" value="{{modelPickerValue}}" bindchange="onModelPickerChange">
              <picker-view-column>
                <view wx:for="{{modelArray}}" wx:key="index" class="picker-item">{{item}}</view>
              </picker-view-column>
            </picker-view>
          </view>
        </view>
      </view>
    </view>
    <view class="form-group">
      <text class="form-label">å…³è”è®¾å¤‡ (å®¡æ ¸é€šè¿‡èµ é€å»¶ä¿)</text>
      <!-- çœŸæœºï¼šä½¿ç”¨åŸç”Ÿ picker -->
      <picker wx:if="{{!useCustomPicker}}" bindchange="bindSnChange" value="{{selectedSnIndex !== null ? selectedSnIndex : 0}}" range="{{myDevices}}" range-key="displaySn" style="width: 100%;">
        <view class="ios-select">
          {{selectedSnIndex !== null ? myDevices[selectedSnIndex].displaySn : 'è¯·é€‰æ‹©è®¾å¤‡'}}
        </view>
      </picker>
      <!-- æ¨¡æ‹Ÿå™¨ï¼šä½¿ç”¨è‡ªå®šä¹‰é€‰æ‹©å™¨ -->
      <view wx:else>
        <view class="ios-select" bindtap="showDevicePicker">
          {{selectedSnIndex !== null ? myDevices[selectedSnIndex].displaySn : 'è¯·é€‰æ‹©è®¾å¤‡'}}
        </view>
        <view class="custom-picker-modal" wx:if="{{showDevicePickerModal}}" catchtap="closeDevicePicker">
          <view class="custom-picker-content" catchtap="preventBubble">
            <view class="picker-header">
              <text class="picker-cancel" bindtap="closeDevicePicker">å–æ¶ˆ</text>
              <text class="picker-title">é€‰æ‹©å…³è”è®¾å¤‡</text>
              <text class="picker-confirm" bindtap="confirmDevicePicker">ç¡®å®š</text>
            </view>
            <picker-view class="picker-view" value="{{devicePickerValue}}" bindchange="onDevicePickerChange">
              <picker-view-column>
                <view wx:for="{{myDevices}}" wx:key="index" class="picker-item">{{item.displaySn}}</view>
              </picker-view-column>
            </picker-view>
          </view>
        </view>
      </view>
    </view>
    <button class="dialog-btn" bindtap="submitForm">{{isSubmitting ? 'æäº¤ä¸­...' : 'æäº¤'}}</button>
  </view>
</view>

<!-- ğŸ”´ è‡ªå®šä¹‰æç¤ºæ¡† -->
<view class="modal-overlay active" wx:if="{{showFormError}}" bindtap="closeFormError">
  <view class="ios-dialog" catchtap="preventBubble">
    <view class="dialog-title center">æç¤º</view>
    <view class="dialog-desc">{{formErrorMsg}}</view>
    <button class="dialog-btn" bindtap="closeFormError">æˆ‘çŸ¥é“äº†</button>
  </view>
</view>

<!-- 7. æˆåŠŸæç¤º -->
<view class="modal-overlay active" wx:if="{{showSuccess}}">
  <view class="ios-dialog">
    <view class="success-content">
      <view class="emoji-icon">ğŸ‰</view>
      <view class="user-name">æäº¤æˆåŠŸ</view>
      <view class="status-badge">ç­‰å¾…å®¡æ ¸</view>
      <view class="dialog-desc" style="margin-top: 20rpx; font-size: 24rpx; color:#666;">å¯åœ¨ã€Œä¸ªäººä¸­å¿ƒ-æˆ‘çš„ç”³è¯·è®°å½•ã€æŸ¥çœ‹ç”³è¯·è¿›åº¦</view>
      <button class="dialog-btn" bindtap="closeSuccess">å¥½çš„</button>
    </view>
  </view>
</view>


<!-- 9. ç®¡ç†å‘˜ä¸Šä¼ è¡¨å• -->
<view class="modal-overlay active" wx:if="{{showAdminForm}}">
  <view class="ios-dialog left-align">
    <view class="dialog-title center">{{isEditing ? 'ä¿®æ”¹æ¡ˆä¾‹' : 'å‘å¸ƒå®˜æ–¹æ¡ˆä¾‹'}}</view>
    <view style="display: flex; gap: 20rpx; margin-bottom: 30rpx;">
      <view class="upload-box" bindtap="chooseAdminVideo">
        <block wx:if="{{!adminVideoPath}}"><view class="upload-icon">ğŸ“¹</view><text class="upload-text">é€‰è§†é¢‘</text></block>
        <video wx:else src="{{adminVideoPath}}" class="preview-media" show-play-btn="{{false}}"></video>
      </view>
      <view class="upload-box" bindtap="chooseAdminCover">
        <block wx:if="{{!adminThumbPath}}"><view class="upload-icon">ğŸ–¼ï¸</view><text class="upload-text">é€‰å°é¢</text></block>
        <image wx:else src="{{adminThumbPath}}" class="preview-media" mode="aspectFill"></image>
      </view>
    </view>
    <view wx:if="{{adminVideoPath}}" class="re-upload-text" style="margin-bottom:20rpx">
       <text bindtap="chooseAdminVideo" style="margin-right:30rpx">é‡é€‰è§†é¢‘</text><text bindtap="chooseAdminCover">é‡é€‰å°é¢</text>
    </view>

    <view class="form-group"><text class="form-label">è½¦å‹åç§°</text><input class="ios-input" placeholder="ä¾‹å¦‚ï¼šæœå¡è¿ª V4" bindinput="onInputVehicle" value="{{vehicleName}}" /></view>
    <view class="form-group">
      <text class="form-label">è½¦å‹åˆ†ç±»</text>
      <!-- çœŸæœºï¼šä½¿ç”¨åŸç”Ÿ picker -->
      <picker wx:if="{{!useCustomPicker}}" bindchange="bindCategoryChange" value="{{categoryIndex !== null ? categoryIndex : 0}}" range="{{categoryArray}}" style="width: 100%;">
        <view class="ios-select">{{categoryIndex!==null?categoryArray[categoryIndex]:'è¯·é€‰æ‹©'}}</view>
      </picker>
      <!-- æ¨¡æ‹Ÿå™¨ï¼šä½¿ç”¨è‡ªå®šä¹‰é€‰æ‹©å™¨ -->
      <view wx:else>
        <view class="ios-select" bindtap="showCategoryPicker">
          {{categoryIndex!==null?categoryArray[categoryIndex]:'è¯·é€‰æ‹©'}}
        </view>
        <view class="custom-picker-modal" wx:if="{{showCategoryPickerModal}}" catchtap="closeCategoryPicker">
          <view class="custom-picker-content" catchtap="preventBubble">
            <view class="picker-header">
              <text class="picker-cancel" bindtap="closeCategoryPicker">å–æ¶ˆ</text>
              <text class="picker-title">é€‰æ‹©è½¦å‹åˆ†ç±»</text>
              <text class="picker-confirm" bindtap="confirmCategoryPicker">ç¡®å®š</text>
            </view>
            <picker-view class="picker-view" value="{{categoryPickerValue}}" bindchange="onCategoryPickerChange">
              <picker-view-column>
                <view wx:for="{{categoryArray}}" wx:key="index" class="picker-item">{{item}}</view>
              </picker-view-column>
            </picker-view>
          </view>
        </view>
      </view>
    </view>
    <view class="form-group">
      <text class="form-label">äº§å“å‹å·</text>
      <!-- çœŸæœºï¼šä½¿ç”¨åŸç”Ÿ picker -->
      <picker wx:if="{{!useCustomPicker}}" bindchange="bindPickerChange" value="{{modelIndex !== null ? modelIndex : 0}}" range="{{modelArray}}" style="width: 100%;">
        <view class="ios-select">{{modelIndex!==null?modelArray[modelIndex]:'è¯·é€‰æ‹©'}}</view>
      </picker>
      <!-- æ¨¡æ‹Ÿå™¨ï¼šä½¿ç”¨è‡ªå®šä¹‰é€‰æ‹©å™¨ -->
      <view wx:else>
        <view class="ios-select" bindtap="showModelPicker">
          {{modelIndex!==null?modelArray[modelIndex]:'è¯·é€‰æ‹©'}}
        </view>
        <view class="custom-picker-modal" wx:if="{{showModelPickerModal}}" catchtap="closeModelPicker">
          <view class="custom-picker-content" catchtap="preventBubble">
            <view class="picker-header">
              <text class="picker-cancel" bindtap="closeModelPicker">å–æ¶ˆ</text>
              <text class="picker-title">é€‰æ‹©äº§å“å‹å·</text>
              <text class="picker-confirm" bindtap="confirmModelPicker">ç¡®å®š</text>
            </view>
            <picker-view class="picker-view" value="{{modelPickerValue}}" bindchange="onModelPickerChange">
              <picker-view-column>
                <view wx:for="{{modelArray}}" wx:key="index" class="picker-item">{{item}}</view>
              </picker-view-column>
            </picker-view>
          </view>
        </view>
      </view>
    </view>
    
    <view style="display: flex; gap: 20rpx;">
      <button class="dialog-btn" style="background:#eee; color:#000" bindtap="closeAdminForm">å–æ¶ˆ</button>
      <button class="dialog-btn" bindtap="submitAdminForm">{{isSubmitting ? 'ä¿å­˜ä¸­...' : (isEditing ? 'ä¿å­˜ä¿®æ”¹' : 'å‘å¸ƒ')}}</button>
    </view>
  </view>
</view>

<!-- 9. ä¸Šä¼ é€‰é¡¹å¼¹çª—ï¼ˆé€‰æ‹©ç›¸å†Œ/å½•åˆ¶ï¼‰ -->
<view class="modal-overlay active" wx:if="{{showUploadOptions}}" bindtap="closeUploadOptions">
  <view class="ios-dialog" catchtap="preventBubble">
    <view class="dialog-title center">é€‰æ‹©ä¸Šä¼ æ–¹å¼</view>
    <view class="upload-options">
      <view class="option-item" bindtap="chooseVideoFromAlbum" data-action="album">
        <view class="option-icon">ğŸ“·</view>
        <view class="option-text">ä»ç›¸å†Œé€‰æ‹©</view>
      </view>
      <view class="option-item" bindtap="chooseRecord" data-action="record">
        <view class="option-icon">ğŸ¥</view>
        <view class="option-text">å½•åˆ¶è§†é¢‘</view>
      </view>
    </view>
    <button class="dialog-btn" style="background:#eee; color:#000; margin-top:20rpx;" bindtap="closeUploadOptions">å–æ¶ˆ</button>
  </view>
</view>

<!-- 10. ç»‘å®šè®¾å¤‡æç¤ºå¼¹çª— -->
<view class="modal-overlay active" wx:if="{{showBindDeviceTip}}" bindtap="closeBindDeviceTip">
  <view class="ios-dialog" catchtap="preventBubble">
    <view class="dialog-title center">éœ€è¦ç»‘å®šè®¾å¤‡</view>
    <view class="dialog-desc">æ‚¨å°šæœªç»‘å®šä»»ä½• MT è®¾å¤‡ï¼Œæ— æ³•å‚ä¸å»¶ä¿æ´»åŠ¨ã€‚è¯·å…ˆå»"æˆ‘çš„"é¡µé¢ç»‘å®šè®¾å¤‡ã€‚</view>
    <view style="display: flex; gap: 20rpx; margin-top: 40rpx;">
      <button class="dialog-btn" style="background:#eee; color:#000; flex: 1;" bindtap="closeBindDeviceTip">å–æ¶ˆ</button>
      <button class="dialog-btn" style="flex: 1;" bindtap="goToBindDevice">å»ç»‘å®š</button>
    </view>
  </view>
</view>

<!-- 11. å…¨å±æ’­æ”¾å™¨ -->
<view 
  class="fullscreen-player-container" 
  wx:if="{{showVideoPlayer}}"
  bindtouchstart="onVideoTouchStart"
  bindtouchmove="onVideoTouchMove"
  bindtouchend="onVideoTouchEnd"
>
  <video 
    src="{{currentVideo.videoUrl}}" 
    class="fullscreen-video" 
    autoplay="{{true}}" 
    controls="{{true}}"
    show-fullscreen-btn="{{false}}"
    enable-play-gesture="{{false}}"
    object-fit="contain" 
    bindended="closeVideoPlayer"
    show-center-play-btn="{{false}}"
    enable-metadata="{{false}}"
    show-mute-btn="{{false}}"
  >
    <!-- ğŸ”´ è§†é¢‘åŠ å¯†ï¼šä½¿ç”¨å¤šå±‚ cover-view è¦†ç›–ï¼Œé˜²æ­¢ç›´æ¥è®¿é—® -->
    <cover-view class="auto-watermark"><cover-view class="wm-text">MT-æ‘©æ”¹ç¤¾</cover-view></cover-view>
    <cover-view class="video-protection-layer"></cover-view>
    <cover-view class="close-video-btn" bindtap="closeVideoPlayer">Ã—</cover-view>
    <cover-view class="video-bottom-info">
      <cover-view class="v-title">{{currentVideo.title}}</cover-view>
      <cover-view class="v-tags">
        <cover-view class="v-tag blue">{{currentVideo.categoryName}}</cover-view>
        <cover-view class="v-tag gray">å‹å·ï¼š{{currentVideo.model}}</cover-view>
      </cover-view>
    </cover-view>
  </video>
</view>

<!-- æœ¬é¡µè‡ªå®šä¹‰ Loadingï¼ˆç™½è‰²è™šåŒ– + loaderï¼ŒåŒ my é¡µï¼‰ -->
<view class="loading-mask" wx:if="{{showLoadingAnimation}}">
  <view class="loader">
    <text class="loader-label">{{loadingText}}</text>
    <view class="loading-bar"></view>
  </view>
</view>

<!-- 12. å½•åˆ¶å…¨å±é¡µ -->
<view class="camera-full-screen {{cameraAnimating ? 'animating' : 'animated'}}" wx:if="{{showCamera}}" catchtouchmove="preventScroll">
  <camera device-position="back" flash="off" style="width: 100%; height: 100%;">
    <cover-view class="cam-overlay">
      <!-- 1. é¡¶éƒ¨å¸ƒå±€ï¼šçº¢ç‚¹ + ç™½è‰²æ—¶é—´ -->
      <cover-view class="rec-header-layout">
        <!-- çº¢ç‚¹ï¼šisRecordingä¸ºtrueæ—¶æ˜¾ç¤ºå¹¶é—ªçƒ -->
        <cover-view class="rec-dot {{isRecording ? 'active' : ''}}"></cover-view>
        <cover-view class="rec-time-text">{{recTimeStr}}</cover-view>
      </cover-view>
      
      <!-- 2. éšç§æç¤ºï¼šåªæœ‰æ–‡å­—ï¼Œèƒ¶å›Šé£æ ¼ -->
      <cover-view class="privacy-tip {{showPrivacyTip ? 'show' : ''}}">
        <cover-view class="privacy-text">MTå›¢é˜Ÿå°†äººå·¥æ‰“ç ä¿éšœæ‚¨çš„éšç§ä¿¡æ¯</cover-view>
      </cover-view>
    </cover-view>
  </camera>

  <!-- åº•éƒ¨æ§åˆ¶ä¿æŒä¸å˜ -->
  <cover-view class="cam-controls">
    <cover-view class="cam-btn text-btn" bindtap="closeCamera">å–æ¶ˆ</cover-view>
    <cover-view class="shutter-outer" catchtap="toggleRecord">
      <cover-view class="shutter-inner {{isRecording ? 'recording breathing' : ''}}"></cover-view>
    </cover-view>
    <cover-view class="cam-btn" style="width: 40px;"></cover-view>
  </cover-view>
</view>

<!-- å…¨å±€è‡ªå®šä¹‰å¼¹çª—ç»„ä»¶ -->
<custom-toast id="custom-toast" />
