<!-- pages/pagenew/pagenew.wxml -->
<view class="container">

<!-- ================= 1. È°∂ÈÉ®ÂØºËà™ ================= -->
<view class="nav-header">
  <view class="nav-back" bindtap="goBack">
    <text class="icon-back">‚Äπ</text>
  </view>

  <view class="brand-box" bindtap="handleTitleClick">
    <text class="brand-main">MT</text>
    <text class="brand-sub">COLLECTION</text>
  </view>
  
  <view class="nav-placeholder"></view>
</view>

<!-- ÁÆ°ÁêÜÂëòÁä∂ÊÄÅÊù° -->
<view class="admin-bar" wx:if="{{isAdmin}}">
  <text>ADMIN MODE</text>
  <view class="btn-exit" bindtap="exitAdmin">ÂÆåÊàê/ÈÄÄÂá∫</view>
</view>

<!-- ================= 2. Ê†∏ÂøÉÊªëÂä®Âå∫ ================= -->
<view class="swiper-container">
  <swiper 
    class="card-swiper" 
    current="{{currentIndex}}" 
    previous-margin="50rpx" 
    next-margin="50rpx" 
    bindchange="onSwiperChange"
    circular="{{false}}"
  >
    <block wx:for="{{products}}" wx:key="_id">
      <swiper-item class="card-wrapper">
        
        <!-- ‚ö†Ô∏è ÂÖ≥ÈîÆ‰øÆÊîπÔºöÈùûÁÆ°ÁêÜÂëòÊ®°Âºè‰∏ãÁÇπÂáªÂç°ÁâáÂèØË∑≥ËΩ¨ÔºåÁÆ°ÁêÜÂëòÊ®°Âºè‰∏ã‰∏çË∑≥ËΩ¨ -->
        <view class="apple-card {{currentIndex === index ? 'active' : ''}}" bindtap="{{!isAdmin ? 'handleCardClick' : ''}}" data-index="{{index}}">
          
          <!-- A. ÂõæÁâáÂå∫Âüü -->
          <view class="card-cover">
            <view class="product-cover-wrapper">
              <image class="cover-img" src="{{item.cover || defaultCover}}" mode="aspectFill" lazy-load/>
              <!-- Ë∑≥ËΩ¨Âè∑Á†ÅÊ†áËØÜÔºàÁÆ°ÁêÜÂëòÊ®°Âºè‰∏ãÂèØÁºñËæëÔºâ -->
              <view wx:if="{{isAdmin}}" class="jump-number-badge" catchtap="handleEditJumpNumber" data-index="{{index}}">
                <text wx:if="{{item.jumpNumber}}">#{{item.jumpNumber}}</text>
                <text wx:else>#</text>
              </view>
            </view>
            
            <!-- [ÁÆ°ÁêÜÂëò] ÂäüËÉΩÂå∫ (Âè™ÊúâÁÆ°ÁêÜÂëòËÉΩÁÇπ) -->
            <block wx:if="{{isAdmin}}">
              <!-- Â∑¶‰∏äËßíÔºöÂà†Èô§ -->
              <view class="admin-btn btn-del" catchtap="handleDeleteProduct">‚úï</view>
              <!-- Âè≥‰∏äËßíÔºöÊç¢Â∞ÅÈù¢ -->
              <view class="admin-btn btn-cam" catchtap="handleUploadCover">üì∑</view>
            </block>
          </view>

          <!-- B. ‰ø°ÊÅØÂå∫Âüü -->
          <view class="card-content">
            <view class="info-text">
              <!-- Ê†áÈ¢ò (ÁÆ°ÁêÜÂëòÁÇπÂáªÂèØ‰øÆ) -->
              <text 
                class="p-title {{isAdmin ? 'editable' : ''}}" 
                catchtap="{{isAdmin ? 'handleEditTitle' : ''}}"
              >{{item.title || 'New Product'}}</text>

              <!-- ‰ª∑Ê†º (ÁÆ°ÁêÜÂëòÁÇπÂáªÂèØ‰øÆ) -->
              <text 
                class="p-price {{isAdmin ? 'editable' : ''}}" 
                catchtap="{{isAdmin ? 'handleEditPrice' : ''}}"
              >¬• {{item.price || '0'}}</text>
            </view>

            <!-- Ë£ÖÈ•∞Áî®ÁöÑÁÆ≠Â§¥ÊåâÈíÆ (Á∫ØË£ÖÈ•∞ÔºåÊó†ÁÇπÂáª‰∫ã‰ª∂) -->
            <view class="btn-go" wx:if="{{!isAdmin}}">
              <view class="icon-arrow"></view>
            </view>
            
            <!-- ÁÆ°ÁêÜÂëòÂèØËßÅÁöÑËÆæÁΩÆÂõæÊ†á (Ë£ÖÈ•∞) -->
            <view class="btn-go admin-icon" wx:if="{{isAdmin}}">‚öôÔ∏è</view>
          </view>

        </view>
      </swiper-item>
    </block>

    <!-- [ÁÆ°ÁêÜÂëò] Êñ∞Âª∫Âç°Áâá -->
    <swiper-item class="card-wrapper" wx:if="{{isAdmin}}">
      <view class="apple-card add-card {{currentIndex === products.length ? 'active' : ''}}" bindtap="handleAddNew">
        <view class="add-icon">+</view>
        <text class="add-text">NEW ARRIVAL</text>
      </view>
    </swiper-item>

  </swiper>
</view>

<!-- ================= 3. ÂØÜÁ†ÅÂºπÁ™ó ================= -->
<view class="modal-mask {{showPasswordModal ? 'active' : ''}}" catchtouchmove="true">
  <view class="modal-box">
    <view class="modal-title">ÁÆ°ÁêÜÂëòÁôªÂΩï</view>
    <input class="pwd-input" type="number" password maxlength="10" bindinput="onPwdInput" value="{{pwdInput}}"/>
    <view class="modal-actions">
      <view class="btn cancel" bindtap="closeModal">ÂèñÊ∂à</view>
      <view class="btn confirm" bindtap="checkPassword">Á°ÆÂÆö</view>
    </view>
  </view>
</view>

</view>