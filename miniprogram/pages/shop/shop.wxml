<!-- pages/shop/shop.wxml -->
<view class="container">

<!-- ================= 1. é¡¶éƒ¨å¯¼èˆª ================= -->
<view class="nav-header">
  <!-- å·¦ä¾§ï¼šè¿”å›æŒ‰é’® -->
  <view class="nav-left">
    <view class="nav-back-btn" bindtap="goBack">
      <text class="icon-back">â€¹</text>
    </view>
  </view>
  
  <!-- ä¸­é—´åŒºåŸŸï¼šæ ‡é¢˜å’Œç®¡ç†å‘˜åˆ‡æ¢æŒ‰é’® -->
  <view class="brand-title" bindtap="handleTitleClick">
    <text>{{shopTitle || 'MT STORE'}}</text>
    <!-- åªæœ‰ç™½åå•ç”¨æˆ·èƒ½çœ‹åˆ°çš„åˆ‡æ¢å¼€å…³ -->
    <view 
      wx:if="{{isAuthorized}}" 
      class="admin-toggle-btn {{isAdmin ? 'on' : ''}}" 
      catchtap="toggleAdminMode">
      {{isAdmin ? 'EXIT' : 'EDIT'}}
    </view>
  </view>
  
  <view class="nav-right"></view>
</view>

<!-- ================= 2. ä¸»é¡µé¢ ================= -->
<scroll-view scroll-y class="main-scroll">
  
  <!-- é¡¶éƒ¨è½®æ’­ (Hero) -->
  <view class="hero-swiper-box">
    <swiper class="hero-swiper" indicator-dots="{{true}}" circular="{{true}}" autoplay="{{!isAdmin}}">
      <block wx:for="{{topMediaList}}" wx:key="url">
        <swiper-item>
          <video wx:if="{{item.type === 'video'}}" src="{{item.url}}" class="hero-media" autoplay muted loop show-play-btn="{{false}}" controls="{{false}}"></video>
          <image wx:else src="{{item.url}}" class="hero-media" mode="aspectFill" />
          
          <view wx:if="{{isAdmin}}" class="admin-del-media" catchtap="adminDelTopMedia" data-index="{{index}}">âœ•</view>
        </swiper-item>
      </block>
    </swiper>
    
    <!-- Admin: å·¦å³åˆ†å¼€çš„ä¸Šä¼ æŒ‰é’® -->
    <view class="admin-upload-row" wx:if="{{isAdmin}}">
       <view class="up-btn" bindtap="adminAddImage">ğŸ“· ä¸Šä¼ å›¾ç‰‡</view>
       <view class="up-btn" bindtap="adminAddVideo">ğŸ¥ ä¸Šä¼ è§†é¢‘</view>
    </view>
  </view>

  <!-- äº§å“åˆ—è¡¨ (å•åˆ—å¤§å¡ç‰‡) -->
  <view class="product-list">
    <block wx:for="{{seriesList}}" wx:key="id">
      <view class="prod-card" bindtap="handleProductClick" data-index="{{index}}">
        <view class="product-cover-wrapper">
          <image class="p-img" src="{{item.cover}}" mode="aspectFill" />
          <!-- è·³è½¬å·ç æ ‡è¯†ï¼ˆç®¡ç†å‘˜æ¨¡å¼ä¸‹å¯ç¼–è¾‘ï¼‰ -->
          <view wx:if="{{isAdmin}}" class="jump-number-badge" catchtap="adminEditJumpNumber" data-index="{{index}}">
            <text wx:if="{{item.jumpNumber}}">#{{item.jumpNumber}}</text>
            <text wx:else>#</text>
          </view>
        </view>
        <view class="admin-float" wx:if="{{isAdmin}}" catchtap="adminUploadCover" data-index="{{index}}">ğŸ“·</view>
        
        <!-- ğŸ‘‡ğŸ‘‡ğŸ‘‡ã€æ–°å¢ã€‘çº¢è‰²åˆ é™¤æŒ‰é’® ğŸ‘‡ğŸ‘‡ğŸ‘‡ -->
        <view class="admin-del-card-btn" wx:if="{{isAdmin}}" catchtap="adminDeleteSeries" data-index="{{index}}">âœ•</view>
        
        <view class="p-info">
           <view class="p-row">
             <text class="p-title {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditSeriesName':''}}" data-index="{{index}}">{{item.name}}</text>
             <text class="p-price">Â¥{{item.models[0].price}} èµ·</text>
           </view>
        </view>
      </view>
    </block>
    <!-- Admin æ·»åŠ äº§å“ -->
    <view class="add-series-btn" wx:if="{{isAdmin}}" bindtap="adminAddSeries">+ æ·»åŠ æ–°äº§å“ç³»åˆ—</view>
  </view>

  <view style="height: 100rpx;"></view>
</scroll-view>

<!-- ================= 3. äº§å“è¯¦æƒ…å¼¹çª— (Detail) ================= -->
<view class="full-modal {{showDetail ? 'active' : ''}}">
  <!-- å¼¹çª—å¤´ -->
  <view class="modal-nav">
    <view class="nav-close" bindtap="closeDetail">âœ•</view>
    <!-- ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼šæ ‡é¢˜å¯ç‚¹å‡»ç¼–è¾‘ï¼Œå¹¶åŒæ­¥åˆ°äº‘ç«¯ -->
    <view 
      class="modal-title {{isAdmin ? 'editable' : ''}}" 
      catchtap="{{isAdmin ? 'adminEditSeriesNameInDetail' : ''}}">
      {{currentSeries.name}}
    </view>
    <view style="width:60rpx"></view>
  </view>

  <!-- å¼¹çª—å†…å®¹åŒº -->
  <!-- 1. ä¿®æ”¹ï¼šç»‘å®šæ»šåŠ¨äº‹ä»¶ bindscroll -->
  <scroll-view scroll-y class="modal-scroll" bindscroll="onDetailScroll">
    <view class="scroll-inner">
      
      <!-- (A) è¯¦æƒ…é•¿å›¾ -->
      <!-- ä¿®æ”¹ 2ï¼šè¯¦æƒ…é¡µé•¿å›¾åŒºåŸŸæ”¯æŒè§†é¢‘ (Detail Images) -->
<view class="detail-images">
         <block wx:for="{{currentSeries.detailImages}}" wx:key="url">
           <view class="dimg-box">
              <!-- åˆ¤æ–­ç±»å‹ï¼šå¦‚æœæ˜¯è§†é¢‘æ˜¾ç¤ºvideoï¼Œå¦åˆ™æ˜¾ç¤ºimage -->
              <video wx:if="{{item.type === 'video'}}" src="{{item.url}}" class="dimg" style="height:400rpx; width:100%;" autoplay muted loop show-play-btn="{{false}}" controls="{{false}}"></video>
              <image wx:else src="{{item.url}}" mode="widthFix" class="dimg" />
              
              <view wx:if="{{isAdmin}}" class="admin-del-abs" catchtap="adminDelDetailImg" data-index="{{index}}">âœ•</view>
           </view>
         </block>
         <!-- æŒ‰é’®æ–‡æ¡ˆæ”¹æˆæ·»åŠ åª’ä½“ -->
         <view class="add-txt-btn" wx:if="{{isAdmin}}" bindtap="adminAddDetailMedia">+ æ·»åŠ è¯¦æƒ…å›¾ç‰‡/è§†é¢‘</view>
      </view>

      <!-- 2. ä¿®æ”¹ï¼šé€‰è´­é…ç½®åŒº (æ”¯æŒæ ‡é¢˜ä¿®æ”¹ + å¯¹æ¯”é€‰æ‹©é€»è¾‘) -->
      <view class="config-sec">
        
        <!-- æ ‡é¢˜è¡Œï¼šå¯¹æ¯”æŒ‰é’®åªåœ¨å‹å·å¤§äº1æ—¶æ˜¾ç¤º -->
        <view class="sec-header-row">
            <view class="sec-title {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditLabel':''}}" data-key="configTitle">
              {{currentSeries.labels.configTitle || 'é€‰è´­é…ç½®'}}
            </view>
            <!-- å¯¹æ¯”æŒ‰é’® -->
            <view class="btn-compare" 
                  wx:if="{{currentSeries.models.length > 1}}" 
                  bindtap="toggleModelCompareMode">
              {{isModelCompareMode ? 'å–æ¶ˆé€‰æ‹©' : 'å‚æ•°å¯¹æ¯”'}}
            </view>
        </view>

        <!-- å¯¹æ¯”ç¡®è®¤æ¡ (æµ®åŠ¨æ˜¾ç¤º) -->
        <view wx:if="{{isModelCompareMode}}" style="text-align:center; margin-bottom:20rpx;">
          <view class="btn-black" style="display:inline-block; font-size:24rpx; padding:10rpx 40rpx;" bindtap="startCompare">
            å¼€å§‹å¯¹æ¯” (å·²é€‰{{compareSelectedModels.length}})
          </view>
        </view>

        <!-- A. é€‰æ‹©å‹å· -->
        <view class="cfg-group">
          <view class="cfg-label {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditLabel':''}}" data-key="modelTitle">
            {{currentSeries.labels.modelTitle || 'é€‰æ‹©å‹å·'}}
          </view>
          
          <block wx:for="{{currentSeries.models}}" wx:key="name">
            <view 
              class="model-card-normal {{ (!isModelCompareMode && selectedModelIdx === index) || (isModelCompareMode && item.isCompareChecked) ? 'selected' : ''}}" 
              bindtap="selectModel" 
              data-index="{{index}}">
              
              <!-- å¯¹æ¯”å‹¾é€‰åœˆ -->
              <view wx:if="{{isModelCompareMode}}" class="circle {{item.isCompareChecked ? 'checked' : ''}}" style="margin-right:20rpx;"></view>

              <view style="flex:1">
                  <text class="m-name {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditModelName':''}}" data-midx="{{index}}">{{item.name}}</text>
                  <text class="m-desc {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditModelDesc':''}}" data-midx="{{index}}">{{item.desc || (isAdmin ? 'ç‚¹å‡»æ·»åŠ æè¿°' : '')}}</text>
              </view>
              
              <text class="m-price {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditModelPrice':''}}" data-midx="{{index}}">Â¥{{item.price}}</text>
              
              <view wx:if="{{isAdmin}}" class="admin-del-mini" catchtap="adminDelModel" data-midx="{{index}}">âœ•</view>
            </view>
          </block>
          <view wx:if="{{isAdmin}}" class="add-txt-btn" bindtap="adminAddModel">+ æ·»åŠ å‹å·</view>
        </view>

        <!-- B. é…ç½®æ–¹æ¡ˆ (æ ‡é¢˜åŠ¨æ€åŒ–) -->
        <view class="cfg-group">
          <view class="cfg-label {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditLabel':''}}" data-key="optionTitle">
            {{currentSeries.labels.optionTitle || 'é…ç½®æ–¹æ¡ˆ'}}
          </view>
          <view class="opt-grid">
             <block wx:for="{{currentSeries.options}}" wx:key="name">
                <view class="opt-card {{selectedOptionIdx === index ? 'selected' : ''}}" bindtap="selectOption" data-index="{{index}}">
                   <image wx:if="{{item.img}}" src="{{item.img}}" class="opt-img" mode="aspectFill" />
                   <view wx:if="{{isAdmin && !item.img}}" class="admin-add-icon" catchtap="adminUploadOptionImg" data-oidx="{{index}}">ğŸ“·</view>
                   
                   <view class="opt-info">
                      <text class="opt-name {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditOptName':''}}" data-oidx="{{index}}">{{item.name}}</text>
                      <text class="opt-sub {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditOptPrice':''}}" data-oidx="{{index}}">{{item.price > 0 ? '+Â¥'+item.price : 'æ ‡é…'}}</text>
                   </view>
                   <view wx:if="{{isAdmin}}" class="admin-del-corner" catchtap="adminDelOption" data-oidx="{{index}}">âœ•</view>
                </view>
             </block>
             <view class="opt-card add-btn" wx:if="{{isAdmin}}" bindtap="adminAddOption">+</view>
          </view>
        </view>

        <!-- C. é…ä»¶åŠ è´­ (æ ‡é¢˜åŠ¨æ€åŒ–) -->
        <view class="cfg-group" wx:if="{{accessoryList.length > 0 || isAdmin}}">
          <view class="cfg-label {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditLabel':''}}" data-key="accTitle">
            {{currentSeries.labels.accTitle || 'é…ä»¶åŠ è´­'}}
          </view>
          <view class="acc-list-v">
            <block wx:for="{{accessoryList}}" wx:key="id">
               <view class="acc-row-card {{item.selected ? 'selected' : ''}}" 
                     bindtap="openAccessoryDetail" data-index="{{index}}">
            
            <image class="acc-thumb" src="{{item.img}}" mode="aspectFill" />
            <!-- Admin æ”¹å›¾ -->
            <view wx:if="{{isAdmin}}" class="admin-float-thumb" catchtap="adminUploadAccThumb" data-index="{{index}}">ğŸ“·</view>

            <view class="acc-info">
                <text class="acc-n">{{item.name}}</text>
                <text class="acc-p">Â¥{{item.price}}</text>
            </view>

            <!-- åŸæ¥çš„ä»£ç ç±»ä¼¼äºï¼š {{item.selected ? 'âœ“' : '+'}} -->

<!-- æ›¿æ¢ä¸ºä¸‹é¢çš„ä»£ç ï¼š -->
<view class="acc-add-btn {{item.selected ? 'checked' : ''}}" 
      catchtap="toggleAccessorySelection" 
      data-index="{{index}}">
   {{item.selected ? 'å·²é€‰' : 'æ·»åŠ '}}
</view>
            
            <!-- ä¿®æ”¹ï¼šåˆ é™¤æŒ‰é’®ä¸¥æ ¼åœ¨å³ä¸Šè§’ -->
            <view wx:if="{{isAdmin}}" class="admin-del-corner-top" catchtap="adminDelAcc" data-index="{{index}}">âœ•</view>
          </view>
            </block>
      <view wx:if="{{isAdmin}}" class="add-txt-btn" bindtap="adminAddAcc">+ æ·»åŠ é…ä»¶</view>
    </view>
  </view>

      </view>
      <!-- è¿™é‡Œæ˜¯ä¸ºäº†è®©æ»šåŠ¨åˆ°åº•éƒ¨æ—¶ï¼Œå†…å®¹ä¸è¢«åº•éƒ¨æ æŒ¡ä½ -->
      <view style="height:200rpx;"></view> 
    </view>
  </scroll-view>

  <!-- 2. ä¿®æ”¹ï¼šåº•éƒ¨ç»“ç®—æ  (å¢åŠ æ˜¾éšæ§åˆ¶ç±») -->
  <!-- åªæœ‰å½“ showFooterBar ä¸º true æ—¶ï¼Œæ·»åŠ  .visible ç±» -->
  <view class="modal-footer {{showFooterBar ? 'visible' : ''}}">
    <view class="footer-btn-group">
      <view class="btn-cart" id="cart-target" bindtap="addToCart">åŠ å…¥è´­ç‰©è½¦</view>
      <view class="btn-buy" bindtap="openCartOrder">ç«‹å³è´­ä¹°</view>
    </view>
  </view>
</view>

<!-- ================= 4. å¯¹æ¯”è¡¨æ ¼å¼¹çª— (åŠ¨æ€åˆ—) ================= -->
<view class="overlay {{showSpecsModal ? 'active' : ''}}" style="z-index: 600;">
  <view class="overlay-head"><view bindtap="closeSpecsModal">âœ•</view><view>å‚æ•°å¯¹æ¯”</view><view></view></view>
  <scroll-view scroll-y class="modal-scroll" style="max-height: 80vh;">
    <view class="specs-table">
       
       <!-- è¡¨å¤´ï¼šåŠ¨æ€æ¸²æŸ“ headers -->
       <view class="sp-row header">
          <view class="sp-cell label">å‚æ•°é¡¹</view>
          <block wx:for="{{compareData.headers}}" wx:key="*this">
             <view class="sp-cell">{{item}}</view>
          </block>
          <view wx:if="{{isAdmin}}" class="sp-cell admin-w"></view>
       </view>
       
       <!-- å†…å®¹ï¼šåŠ¨æ€æ¸²æŸ“ rows å’Œ vals -->
       <block wx:for="{{compareData.rows}}" wx:key="label" wx:for-index="rowIdx">
         <view class="sp-row">
            <view class="sp-cell label {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditSpecCell':''}}" data-row="{{rowIdx}}" data-key="label">{{item.label}}</view>
            <!-- é‡Œé¢çš„å€¼ä¹Ÿå¾ªç¯ -->
            <block wx:for="{{item.vals}}" wx:for-item="val" wx:key="*this" wx:for-index="valIdx">
               <view class="sp-cell {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditSpecCell':''}}" data-row="{{rowIdx}}" data-key="v{{valIdx+1}}">{{val}}</view>
            </block>
            <view wx:if="{{isAdmin}}" class="sp-cell admin-w" catchtap="adminDelSpecRow" data-index="{{rowIdx}}">âœ•</view>
         </view>
       </block>
       <view wx:if="{{isAdmin}}" class="add-txt-btn" bindtap="adminAddSpecRow">+ æ·»åŠ å‚æ•°è¡Œ</view>
       
       <!-- ============ [æ–°å¢] åº•éƒ¨å…¨å±€è§†é¢‘åŒºåŸŸ ============ -->
       
       <!-- é€»è¾‘ï¼šå¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæˆ–è€… (å·²æœ‰è§†é¢‘ ä¸” å¼€å…³æ˜¯æ‰“å¼€çš„) æ˜¾ç¤ºåŒºåŸŸ -->
       <view class="spec-video-footer" 
             wx:if="{{isAdmin || (currentSeries.compareVideo && currentSeries.showCompareVideo)}}">
         
         <!-- 1. ä¸»æŒ‰é’®ï¼šæŸ¥çœ‹å¯¹æ¯”æ¼”ç¤º -->
         <view class="btn-watch-compare" bindtap="watchCompareVideo">
           <text class="icon-play">â–¶</text> æŸ¥çœ‹å¯¹æ¯”æ¼”ç¤ºè§†é¢‘
         </view>

         <!-- 2. ç®¡ç†å‘˜æ§åˆ¶é¢æ¿ (ä»…ç®¡ç†å‘˜å¯è§) -->
         <view class="admin-video-controls" wx:if="{{isAdmin}}">
           <!-- ä¸Šä¼ æŒ‰é’® -->
           <view class="admin-v-btn upload" bindtap="adminUploadCompareVideo">
             {{currentSeries.compareVideo ? 'æ›´æ¢è§†é¢‘' : 'ä¸Šä¼ è§†é¢‘'}}
           </view>
           
           <!-- æ˜¾ç¤º/éšè—å¼€å…³ -->
           <view class="admin-v-btn toggle {{currentSeries.showCompareVideo ? 'on' : 'off'}}" 
                 bindtap="adminToggleVideoVis">
             çŠ¶æ€: {{currentSeries.showCompareVideo ? 'å·²æ˜¾ç¤º' : 'å·²éšè—'}}
           </view>
         </view>

       </view>
    </view>
  </scroll-view>
</view>

<!-- ================= 5. é…ä»¶è¯¦æƒ…å¼¹çª— (Accessory Detail) ================= -->
<view class="full-modal {{showAccDetail ? 'active' : ''}}" style="z-index: 300;">
  <view class="modal-nav">
     <view class="nav-close" bindtap="closeAccessoryDetail">âœ•</view>
     <view class="modal-title">é…ä»¶è¯¦æƒ…</view>
     <view style="width:60rpx"></view>
  </view>
  <scroll-view scroll-y class="modal-scroll">
     <!-- é…ä»¶å¤§å›¾ -->
     <view class="acc-detail-hero">
        <image wx:if="{{accessoryList[currentAccIdx].detailImages.length>0}}" 
               src="{{accessoryList[currentAccIdx].detailImages[0]}}" mode="widthFix" class="dimg"/>
        <view wx:else style="padding:100rpx; text-align:center; color:#ccc;">ç‚¹å‡»ä¸‹æ–¹æ·»åŠ è¯¦æƒ…å›¾</view>
        
        <view wx:if="{{isAdmin}}" class="add-txt-btn" bindtap="adminAddAccDetailImg">+ æ·»åŠ /æ›´æ¢å›¾ç‰‡</view>
     </view>
     
     <!-- é…ä»¶ä¿¡æ¯ -->
     <view class="acc-detail-info">
        <view class="acc-d-name {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditAccName':''}}">{{accessoryList[currentAccIdx].name}}</view>
        <view class="acc-d-price {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditAccPrice':''}}">Â¥{{accessoryList[currentAccIdx].price}}</view>
        <view class="acc-d-desc {{isAdmin?'editable':''}}" catchtap="{{isAdmin?'adminEditAccDesc':''}}">{{accessoryList[currentAccIdx].desc || 'æš‚æ— æè¿°'}}</view>
     </view>
  </scroll-view>
  
  <view class="modal-footer">
     <view></view>
     <view class="btn-black full" bindtap="addAccToCartFromDetail">åŠ å…¥è´­ç‰©è¢‹</view>
  </view>
</view>

<!-- ============================================================== -->
<!-- 1. æ–°å¢ï¼šåŠ å…¥è´­ç‰©è½¦æˆåŠŸå¼¹çª— (UIç¾åŒ–) -->
<!-- ============================================================== -->
<view class="success-mask" wx:if="{{showCartSuccess}}">
  <view class="success-box">
    <view class="s-icon">âœ”</view>
    <view class="s-title">å·²åŠ å…¥è´­ç‰©è½¦</view>
    <view class="s-desc">å•†å“å·²ä¿å­˜ï¼Œæ‚¨å¯ä»¥ç»§ç»­é€‰è´­æˆ–å»ç»“ç®—</view>
    
    <view class="s-btn-row">
      <view class="s-btn outline" bindtap="onContinueShopping">ç»§ç»­é€‰è´­</view>
      <view class="s-btn fill" bindtap="onGoToCheckout">ç«‹å³ç»“ç®—</view>
    </view>
  </view>
</view>

<!-- ============================================================== -->
<!-- 2. é‡åšï¼šè®¢å•ç¡®è®¤/ç»“ç®—å¼¹çª— ================= -->
<!-- ============================================================== -->

<!-- 1. [æ–°å¢] é»‘è‰²åŠé€æ˜é®ç½©å±‚ (ç‚¹èƒŒæ™¯ä¹Ÿèƒ½å…³é—­) -->
<view class="dark-mask" wx:if="{{showOrderModal}}" bindtap="closeOrderModal"></view>

<!-- 2. å¼¹çª—ä¸»ä½“ (ä¿æŒä¸å˜ï¼Œåªæ˜¯ä¸ºäº†å®šä½) -->
<view class="overlay full-screen-overlay {{showOrderModal ? 'active' : ''}}" style="z-index: 600;">
  <!-- é¡¶éƒ¨ -->
  <view class="checkout-header">
    <view class="nav-close" bindtap="closeOrderModal">âœ•</view>
    <view class="co-title">ç¡®è®¤è®¢å•</view>
    <view style="width:40rpx"></view>
  </view>

  <scroll-view scroll-y class="checkout-scroll">
    <view class="checkout-body">
      
      <!-- å•†å“æ¸…å• (å¡ç‰‡å¼) -->
      <view class="group-card">
        <block wx:for="{{cart}}" wx:key="id">
          <view class="cart-row">
            <!-- å·¦ä¾§ä¿¡æ¯ -->
            <view class="cr-info">
              <view class="cr-name">{{item.name}}</view>
              <view class="cr-spec">{{item.spec}}</view>
            </view>
            
            <!-- å³ä¾§ä»·æ ¼ä¸æ•°é‡ -->
            <view class="cr-action">
              <view class="cr-price">Â¥{{item.total}}</view>
              <!-- å°å·§çš„åŠ å‡å™¨ -->
              <view class="mini-stepper">
                <view class="ms-btn" catchtap="handleCartQty" data-index="{{index}}" data-type="minus">-</view>
                <view class="ms-num">{{item.quantity}}</view>
                <view class="ms-btn" catchtap="handleCartQty" data-index="{{index}}" data-type="plus">+</view>
              </view>
            </view>
          </view>
        </block>
        
          <view wx:if="{{cart.length === 0}}" class="empty-cart">è´­ç‰©è½¦æš‚æ— å•†å“</view>
        
        <!-- æ€»ä»·è¡Œ -->
        <view class="total-row">
          <text>æ€»è®¡</text>
          <text class="big-price">Â¥{{cartTotalPrice}}</text>
        </view>
      </view>

      <!-- ================= æ›¿æ¢å¼€å§‹ ================= -->
      
      <!-- 1. è¿™ä¸€è¡Œæ˜¯æ–°çš„æ ‡é¢˜æ ï¼šå·¦è¾¹æ˜¯æ ‡é¢˜ï¼Œå³è¾¹æ˜¯æŒ‰é’® -->
      <view class="group-header-row">
        <!-- å·¦è¾¹æ–‡å­— -->
        <view class="group-title-text">æ”¶è´§ä¿¡æ¯</view>
        
        <!-- å³è¾¹æŒ‰é’® (ç”»åœˆçš„ä½ç½®) -->
        <view class="paste-btn-header" bindtap="openSmartPasteModal">æ™ºèƒ½ç²˜è´´</view>
      </view>

      <!-- 2. è¡¨å•åŒºåŸŸ -->
      <view class="group-card form-group">
        <view class="form-item">
          <view class="form-label">æ”¶è´§äºº</view>
          <input class="form-input" placeholder="è¯·å¡«å†™å§“å" placeholder-class="ph-style" bindinput="onInput" data-key="name" value="{{orderInfo.name}}"/>
        </view>
        <view class="form-item">
          <view class="form-label">æ‰‹æœºå·</view>
          <input class="form-input" type="number" placeholder="è¯·å¡«å†™æ‰‹æœºå·ç " placeholder-class="ph-style" bindinput="onInput" data-key="phone" value="{{orderInfo.phone}}"/>
        </view>
        <view class="form-item">
          <view class="form-label">åœ°å€</view>
          <!-- æ³¨æ„ï¼šè¿™é‡ŒåŸæ¥çš„ ç²˜è´´æŒ‰é’® å·²ç»è¢«å½»åº•åˆ é™¤äº†ï¼Œåœ°å€æ ç°åœ¨å¾ˆå¹²å‡€ -->
          <input class="form-input" placeholder="çœ/å¸‚/åŒº/è¡—é“é—¨ç‰Œ" placeholder-class="ph-style" bindinput="onInput" data-key="address" value="{{orderInfo.address}}"/>
        </view>
      </view>
      <!-- ================= æ›¿æ¢ç»“æŸ ================= -->

    </view>
  </scroll-view>

  <!-- åº•éƒ¨æäº¤æŒ‰é’® -->
  <view class="checkout-footer">
    <!-- æ˜¾ç¤ºé‡‘é¢ï¼Œæ›´åƒæ­£è§„æ”¯ä»˜æŒ‰é’® -->
    <view class="btn-black full" bindtap="submitOrder">
      ç«‹å³æ”¯ä»˜ Â¥{{cartTotalPrice}}
    </view>
  </view>
</view>

<!-- ================= 7. ç®¡ç†å‘˜å¯†ç å¼¹çª— (Oval Input) ================= -->
<!-- 1. åœ¨ <view class="container"> çš„ æœ€ä¸‹æ–¹ æ·»åŠ  è‡ªå®šä¹‰ç¼–è¾‘å¼¹çª— -->
<view class="custom-modal-mask" wx:if="{{showCustomEditModal}}">
  <view class="custom-modal-box">
    <view class="custom-modal-title">{{customEditTitle}}</view>
    <input class="custom-modal-input" value="{{customEditVal}}" bindinput="onCustomEditInput" focus="{{showCustomEditModal}}" cursor-spacing="100"/>
    <view class="custom-modal-btn-row">
      <view class="custom-btn c-btn-cancel" bindtap="closeCustomEditModal">å–æ¶ˆ</view>
      <view class="custom-btn c-btn-confirm" bindtap="confirmCustomEdit">ç¡®å®š</view>
    </view>
  </view>
</view>


<!-- ================= 8. æ–°å¢ï¼šå±å¹•ä¸­é—´æç¤ºæ°”æ³¡ ================= -->
<view class="center-toast-mask" wx:if="{{centerToast.show}}">
  <view class="center-toast-box">
    <view class="ct-icon">!</view> <!-- ç®€å•å¹å·å›¾æ ‡ -->
    <view class="ct-text">{{centerToast.text}}</view>
  </view>
</view>

<!-- ================= 9. [æ–°å¢] æ™ºèƒ½ç²˜è´´è¾“å…¥å¼¹çª— ================= -->
<view class="smart-paste-mask" wx:if="{{showSmartPasteModal}}" style="z-index: 99999;">
  <view class="smart-paste-box">
    <view class="sp-title">æ™ºèƒ½ç²˜è´´</view>
    <view class="sp-desc">è¯·å°†å§“åã€ç”µè¯ã€åœ°å€ç²˜è´´åˆ°ä¸‹æ–¹æ¡†ä¸­</view>
    
    <!-- è¾“å…¥åŒºåŸŸ -->
    <textarea 
      class="sp-textarea" 
      placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰ 13800138000 å¹¿ä¸œçœæ·±åœ³å¸‚å—å±±åŒº..." 
      value="{{smartPasteVal}}" 
      bindinput="onSmartPasteInput"
      adjust-position="{{true}}"
      fixed="{{true}}"
    ></textarea>
    
    <view class="sp-btn-row">
      <view class="sp-btn cancel" bindtap="closeSmartPasteModal">å–æ¶ˆ</view>
      <view class="sp-btn confirm" bindtap="confirmSmartPaste">æ™ºèƒ½åˆ†æ</view>
    </view>
  </view>
</view>

<!-- ================= 10. [æ–°å¢] è‡ªå®šä¹‰å…¨å±è§†é¢‘æ’­æ”¾å™¨ ================= -->
<view class="video-modal-mask" wx:if="{{showVideoPlayer}}" style="z-index: 99999;">
  
  <!-- å…³é—­æŒ‰é’® (ä½ è¦çš„ X) -->
  <view class="video-close-btn" bindtap="closeVideoPlayer">âœ•</view>

  <!-- è§†é¢‘ç»„ä»¶ -->
  <video 
    src="{{currentVideoUrl}}" 
    autoplay="{{true}}" 
    class="fullscreen-video" 
    show-fullscreen-btn="{{false}}" 
    object-fit="contain"
  ></video>
  
</view>

</view>